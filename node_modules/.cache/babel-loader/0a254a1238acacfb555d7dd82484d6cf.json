{"ast":null,"code":"var JSONToShape, LinePath, TextRenderer, _createLinePathFromData, _doAllPointsShareStyle, _dual, _mid, _refine, bspline, createShape, defineCanvasRenderer, defineSVGRenderer, defineShape, lineEndCapShapes, linePathFuncs, ref, ref1, renderShapeToContext, renderShapeToSVG, shapeToJSON, shapes, util;\n\nutil = require('./util');\nTextRenderer = require('./TextRenderer');\nlineEndCapShapes = require('./lineEndCapShapes');\nref = require('./canvasRenderer'), defineCanvasRenderer = ref.defineCanvasRenderer, renderShapeToContext = ref.renderShapeToContext;\nref1 = require('./svgRenderer'), defineSVGRenderer = ref1.defineSVGRenderer, renderShapeToSVG = ref1.renderShapeToSVG;\nshapes = {};\n\ndefineShape = function (name, props) {\n  var Shape, drawFunc, drawLatestFunc, k, legacyDrawFunc, legacyDrawLatestFunc, legacySVGFunc, svgFunc;\n\n  Shape = function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) {\n    props.constructor.call(this, a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p);\n    return this;\n  };\n\n  Shape.prototype.className = name;\n  Shape.fromJSON = props.fromJSON;\n\n  if (props.draw) {\n    legacyDrawFunc = props.draw;\n\n    legacyDrawLatestFunc = props.draw || function (ctx, bufferCtx, retryCallback) {\n      return this.draw(ctx, bufferCtx, retryCallback);\n    };\n\n    drawFunc = function (ctx, shape, retryCallback) {\n      return legacyDrawFunc.call(shape, ctx, retryCallback);\n    };\n\n    drawLatestFunc = function (ctx, bufferCtx, shape, retryCallback) {\n      return legacyDrawLatestFunc.call(shape, ctx, bufferCtx, retryCallback);\n    };\n\n    delete props.draw;\n\n    if (props.drawLatest) {\n      delete props.drawLatest;\n    }\n\n    defineCanvasRenderer(name, drawFunc, drawLatestFunc);\n  }\n\n  if (props.toSVG) {\n    legacySVGFunc = props.toSVG;\n\n    svgFunc = function (shape) {\n      return legacySVGFunc.call(shape);\n    };\n\n    delete props.toSVG;\n    defineSVGRenderer(name, svgFunc);\n  }\n\n  Shape.prototype.draw = function (ctx, retryCallback) {\n    return renderShapeToContext(ctx, this, {\n      retryCallback: retryCallback\n    });\n  };\n\n  Shape.prototype.drawLatest = function (ctx, bufferCtx, retryCallback) {\n    return renderShapeToContext(ctx, this, {\n      retryCallback: retryCallback,\n      bufferCtx: bufferCtx,\n      shouldOnlyDrawLatest: true\n    });\n  };\n\n  Shape.prototype.toSVG = function () {\n    return renderShapeToSVG(this);\n  };\n\n  for (k in props) {\n    if (k !== 'fromJSON') {\n      Shape.prototype[k] = props[k];\n    }\n  }\n\n  shapes[name] = Shape;\n  return Shape;\n};\n\ncreateShape = function (name, a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) {\n  var s;\n  s = new shapes[name](a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p);\n  s.id = util.getGUID();\n  return s;\n};\n\nJSONToShape = function (arg) {\n  var className, data, id, shape;\n  className = arg.className, data = arg.data, id = arg.id;\n\n  if (className in shapes) {\n    shape = shapes[className].fromJSON(data);\n\n    if (shape) {\n      if (id) {\n        shape.id = id;\n      }\n\n      return shape;\n    } else {\n      console.log('Unreadable shape:', className, data);\n      return null;\n    }\n  } else {\n    console.log(\"Unknown shape:\", className, data);\n    return null;\n  }\n};\n\nshapeToJSON = function (shape) {\n  return {\n    className: shape.className,\n    data: shape.toJSON(),\n    id: shape.id\n  };\n};\n\nbspline = function (points, order) {\n  if (!order) {\n    return points;\n  }\n\n  return bspline(_dual(_dual(_refine(points))), order - 1);\n};\n\n_refine = function (points) {\n  var index, len, point, q, refined;\n  points = [points[0]].concat(points).concat(util.last(points));\n  refined = [];\n  index = 0;\n\n  for (q = 0, len = points.length; q < len; q++) {\n    point = points[q];\n    refined[index * 2] = point;\n\n    if (points[index + 1]) {\n      refined[index * 2 + 1] = _mid(point, points[index + 1]);\n    }\n\n    index += 1;\n  }\n\n  return refined;\n};\n\n_dual = function (points) {\n  var dualed, index, len, point, q;\n  dualed = [];\n  index = 0;\n\n  for (q = 0, len = points.length; q < len; q++) {\n    point = points[q];\n\n    if (points[index + 1]) {\n      dualed[index] = _mid(point, points[index + 1]);\n    }\n\n    index += 1;\n  }\n\n  return dualed;\n};\n\n_mid = function (a, b) {\n  return createShape('Point', {\n    x: a.x + (b.x - a.x) / 2,\n    y: a.y + (b.y - a.y) / 2,\n    size: a.size + (b.size - a.size) / 2,\n    color: a.color\n  });\n};\n\ndefineShape('Image', {\n  constructor: function (args) {\n    if (args == null) {\n      args = {};\n    }\n\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.scale = args.scale || 1;\n    return this.image = args.image || null;\n  },\n  getBoundingRect: function () {\n    return {\n      x: this.x,\n      y: this.y,\n      width: this.image.width * this.scale,\n      height: this.image.height * this.scale\n    };\n  },\n  toJSON: function () {\n    return {\n      x: this.x,\n      y: this.y,\n      imageSrc: this.image.src,\n      imageObject: this.image,\n      scale: this.scale\n    };\n  },\n  fromJSON: function (data) {\n    var img, ref2;\n    img = null;\n\n    if ((ref2 = data.imageObject) != null ? ref2.width : void 0) {\n      img = data.imageObject;\n    } else {\n      img = new Image();\n      img.src = data.imageSrc;\n    }\n\n    return createShape('Image', {\n      x: data.x,\n      y: data.y,\n      image: img,\n      scale: data.scale\n    });\n  },\n  move: function (moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function (upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\ndefineShape('Rectangle', {\n  constructor: function (args) {\n    if (args == null) {\n      args = {};\n    }\n\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.width = args.width || 0;\n    this.height = args.height || 0;\n    this.strokeWidth = args.strokeWidth || 1;\n    this.strokeColor = args.strokeColor || 'black';\n    return this.fillColor = args.fillColor || 'transparent';\n  },\n  getBoundingRect: function () {\n    return {\n      x: this.x - this.strokeWidth / 2,\n      y: this.y - this.strokeWidth / 2,\n      width: this.width + this.strokeWidth,\n      height: this.height + this.strokeWidth\n    };\n  },\n  toJSON: function () {\n    return {\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n      strokeWidth: this.strokeWidth,\n      strokeColor: this.strokeColor,\n      fillColor: this.fillColor\n    };\n  },\n  fromJSON: function (data) {\n    return createShape('Rectangle', data);\n  },\n  move: function (moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function (upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\ndefineShape('Ellipse', {\n  constructor: function (args) {\n    if (args == null) {\n      args = {};\n    }\n\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.width = args.width || 0;\n    this.height = args.height || 0;\n    this.strokeWidth = args.strokeWidth || 1;\n    this.strokeColor = args.strokeColor || 'black';\n    return this.fillColor = args.fillColor || 'transparent';\n  },\n  getBoundingRect: function () {\n    return {\n      x: this.x - this.strokeWidth / 2,\n      y: this.y - this.strokeWidth / 2,\n      width: this.width + this.strokeWidth,\n      height: this.height + this.strokeWidth\n    };\n  },\n  toJSON: function () {\n    return {\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n      strokeWidth: this.strokeWidth,\n      strokeColor: this.strokeColor,\n      fillColor: this.fillColor\n    };\n  },\n  fromJSON: function (data) {\n    return createShape('Ellipse', data);\n  },\n  move: function (moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function (upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\ndefineShape('Line', {\n  constructor: function (args) {\n    if (args == null) {\n      args = {};\n    }\n\n    this.x1 = args.x1 || 0;\n    this.y1 = args.y1 || 0;\n    this.x2 = args.x2 || 0;\n    this.y2 = args.y2 || 0;\n    this.strokeWidth = args.strokeWidth || 1;\n    this.color = args.color || 'black';\n    this.capStyle = args.capStyle || 'round';\n    this.endCapShapes = args.endCapShapes || [null, null];\n    return this.dash = args.dash || null;\n  },\n  getBoundingRect: function () {\n    return {\n      x: Math.min(this.x1, this.x2) - this.strokeWidth / 2,\n      y: Math.min(this.y1, this.y2) - this.strokeWidth / 2,\n      width: Math.abs(this.x2 - this.x1) + this.strokeWidth / 2,\n      height: Math.abs(this.y2 - this.y1) + this.strokeWidth / 2\n    };\n  },\n  toJSON: function () {\n    return {\n      x1: this.x1,\n      y1: this.y1,\n      x2: this.x2,\n      y2: this.y2,\n      strokeWidth: this.strokeWidth,\n      color: this.color,\n      capStyle: this.capStyle,\n      dash: this.dash,\n      endCapShapes: this.endCapShapes\n    };\n  },\n  fromJSON: function (data) {\n    return createShape('Line', data);\n  },\n  move: function (moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n\n    this.x1 = this.x1 - moveInfo.xDiff;\n    this.y1 = this.y1 - moveInfo.yDiff;\n    this.x2 = this.x2 - moveInfo.xDiff;\n    return this.y2 = this.y2 - moveInfo.yDiff;\n  },\n  setUpperLeft: function (upperLeft) {\n    var br, xDiff, yDiff;\n\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n\n    br = this.getBoundingRect();\n    xDiff = br.x - upperLeft.x;\n    yDiff = br.y - upperLeft.y;\n    return this.move({\n      xDiff: xDiff,\n      yDiff: yDiff\n    });\n  }\n});\n\n_doAllPointsShareStyle = function (points) {\n  var color, len, point, q, size;\n\n  if (!points.length) {\n    return false;\n  }\n\n  size = points[0].size;\n  color = points[0].color;\n\n  for (q = 0, len = points.length; q < len; q++) {\n    point = points[q];\n\n    if (!(point.size === size && point.color === color)) {\n      console.log(size, color, point.size, point.color);\n    }\n\n    if (!(point.size === size && point.color === color)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\n_createLinePathFromData = function (shapeName, data) {\n  var pointData, points, smoothedPoints, x, y;\n  points = null;\n\n  if (data.points) {\n    points = function () {\n      var len, q, ref2, results;\n      ref2 = data.points;\n      results = [];\n\n      for (q = 0, len = ref2.length; q < len; q++) {\n        pointData = ref2[q];\n        results.push(JSONToShape(pointData));\n      }\n\n      return results;\n    }();\n  } else if (data.pointCoordinatePairs) {\n    points = function () {\n      var len, q, ref2, ref3, results;\n      ref2 = data.pointCoordinatePairs;\n      results = [];\n\n      for (q = 0, len = ref2.length; q < len; q++) {\n        ref3 = ref2[q], x = ref3[0], y = ref3[1];\n        results.push(JSONToShape({\n          className: 'Point',\n          data: {\n            x: x,\n            y: y,\n            size: data.pointSize,\n            color: data.pointColor,\n            smooth: data.smooth\n          }\n        }));\n      }\n\n      return results;\n    }();\n  }\n\n  smoothedPoints = null;\n\n  if (data.smoothedPointCoordinatePairs) {\n    smoothedPoints = function () {\n      var len, q, ref2, ref3, results;\n      ref2 = data.smoothedPointCoordinatePairs;\n      results = [];\n\n      for (q = 0, len = ref2.length; q < len; q++) {\n        ref3 = ref2[q], x = ref3[0], y = ref3[1];\n        results.push(JSONToShape({\n          className: 'Point',\n          data: {\n            x: x,\n            y: y,\n            size: data.pointSize,\n            color: data.pointColor,\n            smooth: data.smooth\n          }\n        }));\n      }\n\n      return results;\n    }();\n  }\n\n  if (!points[0]) {\n    return null;\n  }\n\n  return createShape(shapeName, {\n    points: points,\n    smoothedPoints: smoothedPoints,\n    order: data.order,\n    tailSize: data.tailSize,\n    smooth: data.smooth\n  });\n};\n\nlinePathFuncs = {\n  constructor: function (args) {\n    var len, point, points, q, results;\n\n    if (args == null) {\n      args = {};\n    }\n\n    points = args.points || [];\n    this.order = args.order || 3;\n    this.tailSize = args.tailSize || 3;\n    this.smooth = 'smooth' in args ? args.smooth : true;\n    this.segmentSize = Math.pow(2, this.order);\n    this.sampleSize = this.tailSize + 1;\n\n    if (args.smoothedPoints) {\n      this.points = args.points;\n      return this.smoothedPoints = args.smoothedPoints;\n    } else {\n      this.points = [];\n      results = [];\n\n      for (q = 0, len = points.length; q < len; q++) {\n        point = points[q];\n        results.push(this.addPoint(point));\n      }\n\n      return results;\n    }\n  },\n  getBoundingRect: function () {\n    return util.getBoundingRect(this.points.map(function (p) {\n      return {\n        x: p.x - p.size / 2,\n        y: p.y - p.size / 2,\n        width: p.size,\n        height: p.size\n      };\n    }));\n  },\n  toJSON: function () {\n    var p, point;\n\n    if (_doAllPointsShareStyle(this.points)) {\n      return {\n        order: this.order,\n        tailSize: this.tailSize,\n        smooth: this.smooth,\n        pointCoordinatePairs: function () {\n          var len, q, ref2, results;\n          ref2 = this.points;\n          results = [];\n\n          for (q = 0, len = ref2.length; q < len; q++) {\n            point = ref2[q];\n            results.push([point.x, point.y]);\n          }\n\n          return results;\n        }.call(this),\n        smoothedPointCoordinatePairs: function () {\n          var len, q, ref2, results;\n          ref2 = this.smoothedPoints;\n          results = [];\n\n          for (q = 0, len = ref2.length; q < len; q++) {\n            point = ref2[q];\n            results.push([point.x, point.y]);\n          }\n\n          return results;\n        }.call(this),\n        pointSize: this.points[0].size,\n        pointColor: this.points[0].color\n      };\n    } else {\n      return {\n        order: this.order,\n        tailSize: this.tailSize,\n        smooth: this.smooth,\n        points: function () {\n          var len, q, ref2, results;\n          ref2 = this.points;\n          results = [];\n\n          for (q = 0, len = ref2.length; q < len; q++) {\n            p = ref2[q];\n            results.push(shapeToJSON(p));\n          }\n\n          return results;\n        }.call(this)\n      };\n    }\n  },\n  fromJSON: function (data) {\n    return _createLinePathFromData('LinePath', data);\n  },\n  addPoint: function (point) {\n    this.points.push(point);\n\n    if (!this.smooth) {\n      this.smoothedPoints = this.points;\n      return;\n    }\n\n    if (!this.smoothedPoints || this.points.length < this.sampleSize) {\n      return this.smoothedPoints = bspline(this.points, this.order);\n    } else {\n      this.tail = util.last(bspline(util.last(this.points, this.sampleSize), this.order), this.segmentSize * this.tailSize);\n      return this.smoothedPoints = this.smoothedPoints.slice(0, this.smoothedPoints.length - this.segmentSize * (this.tailSize - 1)).concat(this.tail);\n    }\n  },\n  move: function (moveInfo) {\n    var len, pt, pts, q;\n\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n\n    if (!this.smooth) {\n      pts = this.points;\n    } else {\n      pts = this.smoothedPoints;\n    }\n\n    for (q = 0, len = pts.length; q < len; q++) {\n      pt = pts[q];\n      pt.move(moveInfo);\n    }\n\n    return this.points = this.smoothedPoints;\n  },\n  setUpperLeft: function (upperLeft) {\n    var br, xDiff, yDiff;\n\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n\n    br = this.getBoundingRect();\n    xDiff = br.x - upperLeft.x;\n    yDiff = br.y - upperLeft.y;\n    return this.move({\n      xDiff: xDiff,\n      yDiff: yDiff\n    });\n  }\n};\nLinePath = defineShape('LinePath', linePathFuncs);\ndefineShape('ErasedLinePath', {\n  constructor: linePathFuncs.constructor,\n  toJSON: linePathFuncs.toJSON,\n  addPoint: linePathFuncs.addPoint,\n  getBoundingRect: linePathFuncs.getBoundingRect,\n  fromJSON: function (data) {\n    return _createLinePathFromData('ErasedLinePath', data);\n  }\n});\ndefineShape('Point', {\n  constructor: function (args) {\n    if (args == null) {\n      args = {};\n    }\n\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.size = args.size || 0;\n    return this.color = args.color || '';\n  },\n  getBoundingRect: function () {\n    return {\n      x: this.x - this.size / 2,\n      y: this.y - this.size / 2,\n      width: this.size,\n      height: this.size\n    };\n  },\n  toJSON: function () {\n    return {\n      x: this.x,\n      y: this.y,\n      size: this.size,\n      color: this.color\n    };\n  },\n  fromJSON: function (data) {\n    return createShape('Point', data);\n  },\n  move: function (moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function (upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\ndefineShape('Polygon', {\n  constructor: function (args) {\n    var len, point, q, ref2, results;\n\n    if (args == null) {\n      args = {};\n    }\n\n    this.points = args.points;\n    this.fillColor = args.fillColor || 'white';\n    this.strokeColor = args.strokeColor || 'black';\n    this.strokeWidth = args.strokeWidth;\n    this.dash = args.dash || null;\n\n    if (args.isClosed == null) {\n      args.isClosed = true;\n    }\n\n    this.isClosed = args.isClosed;\n    ref2 = this.points;\n    results = [];\n\n    for (q = 0, len = ref2.length; q < len; q++) {\n      point = ref2[q];\n      point.color = this.strokeColor;\n      results.push(point.size = this.strokeWidth);\n    }\n\n    return results;\n  },\n  addPoint: function (x, y) {\n    return this.points.push(LC.createShape('Point', {\n      x: x,\n      y: y\n    }));\n  },\n  getBoundingRect: function () {\n    return util.getBoundingRect(this.points.map(function (p) {\n      return p.getBoundingRect();\n    }));\n  },\n  toJSON: function () {\n    return {\n      strokeWidth: this.strokeWidth,\n      fillColor: this.fillColor,\n      strokeColor: this.strokeColor,\n      dash: this.dash,\n      isClosed: this.isClosed,\n      pointCoordinatePairs: this.points.map(function (p) {\n        return [p.x, p.y];\n      })\n    };\n  },\n  fromJSON: function (data) {\n    data.points = data.pointCoordinatePairs.map(function (arg) {\n      var x, y;\n      x = arg[0], y = arg[1];\n      return createShape('Point', {\n        x: x,\n        y: y,\n        size: data.strokeWidth,\n        color: data.strokeColor\n      });\n    });\n    return createShape('Polygon', data);\n  },\n  move: function (moveInfo) {\n    var len, pt, q, ref2, results;\n\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n\n    ref2 = this.points;\n    results = [];\n\n    for (q = 0, len = ref2.length; q < len; q++) {\n      pt = ref2[q];\n      results.push(pt.move(moveInfo));\n    }\n\n    return results;\n  },\n  setUpperLeft: function (upperLeft) {\n    var br, xDiff, yDiff;\n\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n\n    br = this.getBoundingRect();\n    xDiff = br.x - upperLeft.x;\n    yDiff = br.y - upperLeft.y;\n    return this.move({\n      xDiff: xDiff,\n      yDiff: yDiff\n    });\n  }\n});\ndefineShape('Text', {\n  constructor: function (args) {\n    if (args == null) {\n      args = {};\n    }\n\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.v = args.v || 0;\n    this.text = args.text || '';\n    this.color = args.color || 'black';\n    this.font = args.font || '18px sans-serif';\n    this.forcedWidth = args.forcedWidth || null;\n    return this.forcedHeight = args.forcedHeight || null;\n  },\n  _makeRenderer: function (ctx) {\n    ctx.lineHeight = 1.2;\n    this.renderer = new TextRenderer(ctx, this.text, this.font, this.forcedWidth, this.forcedHeight);\n\n    if (this.v < 1) {\n      console.log('repairing baseline');\n      this.v = 1;\n      this.x -= this.renderer.metrics.bounds.minx;\n      return this.y -= this.renderer.metrics.leading - this.renderer.metrics.descent;\n    }\n  },\n  setText: function (text) {\n    this.text = text;\n    return this.renderer = null;\n  },\n  setFont: function (font) {\n    this.font = font;\n    return this.renderer = null;\n  },\n  setPosition: function (x, y) {\n    this.x = x;\n    return this.y = y;\n  },\n  setSize: function (forcedWidth, forcedHeight) {\n    this.forcedWidth = Math.max(forcedWidth, 0);\n    this.forcedHeight = Math.max(forcedHeight, 0);\n    return this.renderer = null;\n  },\n  enforceMaxBoundingRect: function (lc) {\n    var br, dx, lcBoundingRect;\n    br = this.getBoundingRect(lc.ctx);\n    lcBoundingRect = {\n      x: -lc.position.x / lc.scale,\n      y: -lc.position.y / lc.scale,\n      width: lc.canvas.width / lc.scale,\n      height: lc.canvas.height / lc.scale\n    };\n\n    if (br.x + br.width > lcBoundingRect.x + lcBoundingRect.width) {\n      dx = br.x - lcBoundingRect.x;\n      this.forcedWidth = lcBoundingRect.width - dx - 10;\n      return this.renderer = null;\n    }\n  },\n  getBoundingRect: function (ctx, isEditing) {\n    if (isEditing == null) {\n      isEditing = false;\n    }\n\n    if (!this.renderer) {\n      if (ctx) {\n        this._makeRenderer(ctx);\n      } else {\n        throw \"Must pass ctx if text hasn't been rendered yet\";\n      }\n    }\n\n    return {\n      x: Math.floor(this.x),\n      y: Math.floor(this.y),\n      width: Math.ceil(this.renderer.getWidth(true)),\n      height: Math.ceil(this.renderer.getHeight())\n    };\n  },\n  toJSON: function () {\n    return {\n      x: this.x,\n      y: this.y,\n      text: this.text,\n      color: this.color,\n      font: this.font,\n      forcedWidth: this.forcedWidth,\n      forcedHeight: this.forcedHeight,\n      v: this.v\n    };\n  },\n  fromJSON: function (data) {\n    return createShape('Text', data);\n  },\n  move: function (moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function (upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\ndefineShape('SelectionBox', {\n  constructor: function (args) {\n    if (args == null) {\n      args = {};\n    }\n\n    this.shape = args.shape;\n\n    if (args.handleSize != null) {\n      this.handleSize = args.handleSize;\n    } else {\n      this.handleSize = 10;\n    }\n\n    this.margin = 4;\n    this.backgroundColor = args.backgroundColor || null;\n    return this._br = this.shape.getBoundingRect(args.ctx);\n  },\n  toJSON: function () {\n    return {\n      shape: shapeToJSON(this.shape),\n      backgroundColor: this.backgroundColor\n    };\n  },\n  fromJSON: function (arg) {\n    var backgroundColor, handleSize, margin, shape;\n    shape = arg.shape, handleSize = arg.handleSize, margin = arg.margin, backgroundColor = arg.backgroundColor;\n    return createShape('SelectionBox', {\n      shape: JSONToShape(shape),\n      backgroundColor: backgroundColor\n    });\n  },\n  getTopLeftHandleRect: function () {\n    return {\n      x: this._br.x - this.handleSize - this.margin,\n      y: this._br.y - this.handleSize - this.margin,\n      width: this.handleSize,\n      height: this.handleSize\n    };\n  },\n  getBottomLeftHandleRect: function () {\n    return {\n      x: this._br.x - this.handleSize - this.margin,\n      y: this._br.y + this._br.height + this.margin,\n      width: this.handleSize,\n      height: this.handleSize\n    };\n  },\n  getTopRightHandleRect: function () {\n    return {\n      x: this._br.x + this._br.width + this.margin,\n      y: this._br.y - this.handleSize - this.margin,\n      width: this.handleSize,\n      height: this.handleSize\n    };\n  },\n  getBottomRightHandleRect: function () {\n    return {\n      x: this._br.x + this._br.width + this.margin,\n      y: this._br.y + this._br.height + this.margin,\n      width: this.handleSize,\n      height: this.handleSize\n    };\n  },\n  getBoundingRect: function () {\n    return {\n      x: this._br.x - this.margin,\n      y: this._br.y - this.margin,\n      width: this._br.width + this.margin * 2,\n      height: this._br.height + this.margin * 2\n    };\n  }\n});\nmodule.exports = {\n  defineShape: defineShape,\n  createShape: createShape,\n  JSONToShape: JSONToShape,\n  shapeToJSON: shapeToJSON\n};","map":{"version":3,"sources":["C:/Users/lukeq/blog/node_modules/literallycanvas/lib/js/core/shapes.js"],"names":["JSONToShape","LinePath","TextRenderer","_createLinePathFromData","_doAllPointsShareStyle","_dual","_mid","_refine","bspline","createShape","defineCanvasRenderer","defineSVGRenderer","defineShape","lineEndCapShapes","linePathFuncs","ref","ref1","renderShapeToContext","renderShapeToSVG","shapeToJSON","shapes","util","require","name","props","Shape","drawFunc","drawLatestFunc","k","legacyDrawFunc","legacyDrawLatestFunc","legacySVGFunc","svgFunc","a","b","c","d","e","f","g","h","i","j","l","m","n","o","p","constructor","call","prototype","className","fromJSON","draw","ctx","bufferCtx","retryCallback","shape","drawLatest","toSVG","shouldOnlyDrawLatest","s","id","getGUID","arg","data","console","log","toJSON","points","order","index","len","point","q","refined","concat","last","length","dualed","x","y","size","color","args","scale","image","getBoundingRect","width","height","imageSrc","src","imageObject","img","ref2","Image","move","moveInfo","xDiff","yDiff","setUpperLeft","upperLeft","strokeWidth","strokeColor","fillColor","x1","y1","x2","y2","capStyle","endCapShapes","dash","Math","min","abs","br","shapeName","pointData","smoothedPoints","results","push","pointCoordinatePairs","ref3","pointSize","pointColor","smooth","smoothedPointCoordinatePairs","tailSize","segmentSize","pow","sampleSize","addPoint","map","tail","slice","pt","pts","isClosed","LC","v","text","font","forcedWidth","forcedHeight","_makeRenderer","lineHeight","renderer","metrics","bounds","minx","leading","descent","setText","setFont","setPosition","setSize","max","enforceMaxBoundingRect","lc","dx","lcBoundingRect","position","canvas","isEditing","floor","ceil","getWidth","getHeight","handleSize","margin","backgroundColor","_br","getTopLeftHandleRect","getBottomLeftHandleRect","getTopRightHandleRect","getBottomRightHandleRect","module","exports"],"mappings":"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","sourcesContent":["var JSONToShape, LinePath, TextRenderer, _createLinePathFromData, _doAllPointsShareStyle, _dual, _mid, _refine, bspline, createShape, defineCanvasRenderer, defineSVGRenderer, defineShape, lineEndCapShapes, linePathFuncs, ref, ref1, renderShapeToContext, renderShapeToSVG, shapeToJSON, shapes, util;\n\nutil = require('./util');\n\nTextRenderer = require('./TextRenderer');\n\nlineEndCapShapes = require('./lineEndCapShapes');\n\nref = require('./canvasRenderer'), defineCanvasRenderer = ref.defineCanvasRenderer, renderShapeToContext = ref.renderShapeToContext;\n\nref1 = require('./svgRenderer'), defineSVGRenderer = ref1.defineSVGRenderer, renderShapeToSVG = ref1.renderShapeToSVG;\n\nshapes = {};\n\ndefineShape = function(name, props) {\n  var Shape, drawFunc, drawLatestFunc, k, legacyDrawFunc, legacyDrawLatestFunc, legacySVGFunc, svgFunc;\n  Shape = function(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) {\n    props.constructor.call(this, a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p);\n    return this;\n  };\n  Shape.prototype.className = name;\n  Shape.fromJSON = props.fromJSON;\n  if (props.draw) {\n    legacyDrawFunc = props.draw;\n    legacyDrawLatestFunc = props.draw || function(ctx, bufferCtx, retryCallback) {\n      return this.draw(ctx, bufferCtx, retryCallback);\n    };\n    drawFunc = function(ctx, shape, retryCallback) {\n      return legacyDrawFunc.call(shape, ctx, retryCallback);\n    };\n    drawLatestFunc = function(ctx, bufferCtx, shape, retryCallback) {\n      return legacyDrawLatestFunc.call(shape, ctx, bufferCtx, retryCallback);\n    };\n    delete props.draw;\n    if (props.drawLatest) {\n      delete props.drawLatest;\n    }\n    defineCanvasRenderer(name, drawFunc, drawLatestFunc);\n  }\n  if (props.toSVG) {\n    legacySVGFunc = props.toSVG;\n    svgFunc = function(shape) {\n      return legacySVGFunc.call(shape);\n    };\n    delete props.toSVG;\n    defineSVGRenderer(name, svgFunc);\n  }\n  Shape.prototype.draw = function(ctx, retryCallback) {\n    return renderShapeToContext(ctx, this, {\n      retryCallback: retryCallback\n    });\n  };\n  Shape.prototype.drawLatest = function(ctx, bufferCtx, retryCallback) {\n    return renderShapeToContext(ctx, this, {\n      retryCallback: retryCallback,\n      bufferCtx: bufferCtx,\n      shouldOnlyDrawLatest: true\n    });\n  };\n  Shape.prototype.toSVG = function() {\n    return renderShapeToSVG(this);\n  };\n  for (k in props) {\n    if (k !== 'fromJSON') {\n      Shape.prototype[k] = props[k];\n    }\n  }\n  shapes[name] = Shape;\n  return Shape;\n};\n\ncreateShape = function(name, a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) {\n  var s;\n  s = new shapes[name](a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p);\n  s.id = util.getGUID();\n  return s;\n};\n\nJSONToShape = function(arg) {\n  var className, data, id, shape;\n  className = arg.className, data = arg.data, id = arg.id;\n  if (className in shapes) {\n    shape = shapes[className].fromJSON(data);\n    if (shape) {\n      if (id) {\n        shape.id = id;\n      }\n      return shape;\n    } else {\n      console.log('Unreadable shape:', className, data);\n      return null;\n    }\n  } else {\n    console.log(\"Unknown shape:\", className, data);\n    return null;\n  }\n};\n\nshapeToJSON = function(shape) {\n  return {\n    className: shape.className,\n    data: shape.toJSON(),\n    id: shape.id\n  };\n};\n\nbspline = function(points, order) {\n  if (!order) {\n    return points;\n  }\n  return bspline(_dual(_dual(_refine(points))), order - 1);\n};\n\n_refine = function(points) {\n  var index, len, point, q, refined;\n  points = [points[0]].concat(points).concat(util.last(points));\n  refined = [];\n  index = 0;\n  for (q = 0, len = points.length; q < len; q++) {\n    point = points[q];\n    refined[index * 2] = point;\n    if (points[index + 1]) {\n      refined[index * 2 + 1] = _mid(point, points[index + 1]);\n    }\n    index += 1;\n  }\n  return refined;\n};\n\n_dual = function(points) {\n  var dualed, index, len, point, q;\n  dualed = [];\n  index = 0;\n  for (q = 0, len = points.length; q < len; q++) {\n    point = points[q];\n    if (points[index + 1]) {\n      dualed[index] = _mid(point, points[index + 1]);\n    }\n    index += 1;\n  }\n  return dualed;\n};\n\n_mid = function(a, b) {\n  return createShape('Point', {\n    x: a.x + ((b.x - a.x) / 2),\n    y: a.y + ((b.y - a.y) / 2),\n    size: a.size + ((b.size - a.size) / 2),\n    color: a.color\n  });\n};\n\ndefineShape('Image', {\n  constructor: function(args) {\n    if (args == null) {\n      args = {};\n    }\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.scale = args.scale || 1;\n    return this.image = args.image || null;\n  },\n  getBoundingRect: function() {\n    return {\n      x: this.x,\n      y: this.y,\n      width: this.image.width * this.scale,\n      height: this.image.height * this.scale\n    };\n  },\n  toJSON: function() {\n    return {\n      x: this.x,\n      y: this.y,\n      imageSrc: this.image.src,\n      imageObject: this.image,\n      scale: this.scale\n    };\n  },\n  fromJSON: function(data) {\n    var img, ref2;\n    img = null;\n    if ((ref2 = data.imageObject) != null ? ref2.width : void 0) {\n      img = data.imageObject;\n    } else {\n      img = new Image();\n      img.src = data.imageSrc;\n    }\n    return createShape('Image', {\n      x: data.x,\n      y: data.y,\n      image: img,\n      scale: data.scale\n    });\n  },\n  move: function(moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function(upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\n\ndefineShape('Rectangle', {\n  constructor: function(args) {\n    if (args == null) {\n      args = {};\n    }\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.width = args.width || 0;\n    this.height = args.height || 0;\n    this.strokeWidth = args.strokeWidth || 1;\n    this.strokeColor = args.strokeColor || 'black';\n    return this.fillColor = args.fillColor || 'transparent';\n  },\n  getBoundingRect: function() {\n    return {\n      x: this.x - this.strokeWidth / 2,\n      y: this.y - this.strokeWidth / 2,\n      width: this.width + this.strokeWidth,\n      height: this.height + this.strokeWidth\n    };\n  },\n  toJSON: function() {\n    return {\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n      strokeWidth: this.strokeWidth,\n      strokeColor: this.strokeColor,\n      fillColor: this.fillColor\n    };\n  },\n  fromJSON: function(data) {\n    return createShape('Rectangle', data);\n  },\n  move: function(moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function(upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\n\ndefineShape('Ellipse', {\n  constructor: function(args) {\n    if (args == null) {\n      args = {};\n    }\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.width = args.width || 0;\n    this.height = args.height || 0;\n    this.strokeWidth = args.strokeWidth || 1;\n    this.strokeColor = args.strokeColor || 'black';\n    return this.fillColor = args.fillColor || 'transparent';\n  },\n  getBoundingRect: function() {\n    return {\n      x: this.x - this.strokeWidth / 2,\n      y: this.y - this.strokeWidth / 2,\n      width: this.width + this.strokeWidth,\n      height: this.height + this.strokeWidth\n    };\n  },\n  toJSON: function() {\n    return {\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n      strokeWidth: this.strokeWidth,\n      strokeColor: this.strokeColor,\n      fillColor: this.fillColor\n    };\n  },\n  fromJSON: function(data) {\n    return createShape('Ellipse', data);\n  },\n  move: function(moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function(upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\n\ndefineShape('Line', {\n  constructor: function(args) {\n    if (args == null) {\n      args = {};\n    }\n    this.x1 = args.x1 || 0;\n    this.y1 = args.y1 || 0;\n    this.x2 = args.x2 || 0;\n    this.y2 = args.y2 || 0;\n    this.strokeWidth = args.strokeWidth || 1;\n    this.color = args.color || 'black';\n    this.capStyle = args.capStyle || 'round';\n    this.endCapShapes = args.endCapShapes || [null, null];\n    return this.dash = args.dash || null;\n  },\n  getBoundingRect: function() {\n    return {\n      x: Math.min(this.x1, this.x2) - this.strokeWidth / 2,\n      y: Math.min(this.y1, this.y2) - this.strokeWidth / 2,\n      width: Math.abs(this.x2 - this.x1) + this.strokeWidth / 2,\n      height: Math.abs(this.y2 - this.y1) + this.strokeWidth / 2\n    };\n  },\n  toJSON: function() {\n    return {\n      x1: this.x1,\n      y1: this.y1,\n      x2: this.x2,\n      y2: this.y2,\n      strokeWidth: this.strokeWidth,\n      color: this.color,\n      capStyle: this.capStyle,\n      dash: this.dash,\n      endCapShapes: this.endCapShapes\n    };\n  },\n  fromJSON: function(data) {\n    return createShape('Line', data);\n  },\n  move: function(moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n    this.x1 = this.x1 - moveInfo.xDiff;\n    this.y1 = this.y1 - moveInfo.yDiff;\n    this.x2 = this.x2 - moveInfo.xDiff;\n    return this.y2 = this.y2 - moveInfo.yDiff;\n  },\n  setUpperLeft: function(upperLeft) {\n    var br, xDiff, yDiff;\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n    br = this.getBoundingRect();\n    xDiff = br.x - upperLeft.x;\n    yDiff = br.y - upperLeft.y;\n    return this.move({\n      xDiff: xDiff,\n      yDiff: yDiff\n    });\n  }\n});\n\n_doAllPointsShareStyle = function(points) {\n  var color, len, point, q, size;\n  if (!points.length) {\n    return false;\n  }\n  size = points[0].size;\n  color = points[0].color;\n  for (q = 0, len = points.length; q < len; q++) {\n    point = points[q];\n    if (!(point.size === size && point.color === color)) {\n      console.log(size, color, point.size, point.color);\n    }\n    if (!(point.size === size && point.color === color)) {\n      return false;\n    }\n  }\n  return true;\n};\n\n_createLinePathFromData = function(shapeName, data) {\n  var pointData, points, smoothedPoints, x, y;\n  points = null;\n  if (data.points) {\n    points = (function() {\n      var len, q, ref2, results;\n      ref2 = data.points;\n      results = [];\n      for (q = 0, len = ref2.length; q < len; q++) {\n        pointData = ref2[q];\n        results.push(JSONToShape(pointData));\n      }\n      return results;\n    })();\n  } else if (data.pointCoordinatePairs) {\n    points = (function() {\n      var len, q, ref2, ref3, results;\n      ref2 = data.pointCoordinatePairs;\n      results = [];\n      for (q = 0, len = ref2.length; q < len; q++) {\n        ref3 = ref2[q], x = ref3[0], y = ref3[1];\n        results.push(JSONToShape({\n          className: 'Point',\n          data: {\n            x: x,\n            y: y,\n            size: data.pointSize,\n            color: data.pointColor,\n            smooth: data.smooth\n          }\n        }));\n      }\n      return results;\n    })();\n  }\n  smoothedPoints = null;\n  if (data.smoothedPointCoordinatePairs) {\n    smoothedPoints = (function() {\n      var len, q, ref2, ref3, results;\n      ref2 = data.smoothedPointCoordinatePairs;\n      results = [];\n      for (q = 0, len = ref2.length; q < len; q++) {\n        ref3 = ref2[q], x = ref3[0], y = ref3[1];\n        results.push(JSONToShape({\n          className: 'Point',\n          data: {\n            x: x,\n            y: y,\n            size: data.pointSize,\n            color: data.pointColor,\n            smooth: data.smooth\n          }\n        }));\n      }\n      return results;\n    })();\n  }\n  if (!points[0]) {\n    return null;\n  }\n  return createShape(shapeName, {\n    points: points,\n    smoothedPoints: smoothedPoints,\n    order: data.order,\n    tailSize: data.tailSize,\n    smooth: data.smooth\n  });\n};\n\nlinePathFuncs = {\n  constructor: function(args) {\n    var len, point, points, q, results;\n    if (args == null) {\n      args = {};\n    }\n    points = args.points || [];\n    this.order = args.order || 3;\n    this.tailSize = args.tailSize || 3;\n    this.smooth = 'smooth' in args ? args.smooth : true;\n    this.segmentSize = Math.pow(2, this.order);\n    this.sampleSize = this.tailSize + 1;\n    if (args.smoothedPoints) {\n      this.points = args.points;\n      return this.smoothedPoints = args.smoothedPoints;\n    } else {\n      this.points = [];\n      results = [];\n      for (q = 0, len = points.length; q < len; q++) {\n        point = points[q];\n        results.push(this.addPoint(point));\n      }\n      return results;\n    }\n  },\n  getBoundingRect: function() {\n    return util.getBoundingRect(this.points.map(function(p) {\n      return {\n        x: p.x - p.size / 2,\n        y: p.y - p.size / 2,\n        width: p.size,\n        height: p.size\n      };\n    }));\n  },\n  toJSON: function() {\n    var p, point;\n    if (_doAllPointsShareStyle(this.points)) {\n      return {\n        order: this.order,\n        tailSize: this.tailSize,\n        smooth: this.smooth,\n        pointCoordinatePairs: (function() {\n          var len, q, ref2, results;\n          ref2 = this.points;\n          results = [];\n          for (q = 0, len = ref2.length; q < len; q++) {\n            point = ref2[q];\n            results.push([point.x, point.y]);\n          }\n          return results;\n        }).call(this),\n        smoothedPointCoordinatePairs: (function() {\n          var len, q, ref2, results;\n          ref2 = this.smoothedPoints;\n          results = [];\n          for (q = 0, len = ref2.length; q < len; q++) {\n            point = ref2[q];\n            results.push([point.x, point.y]);\n          }\n          return results;\n        }).call(this),\n        pointSize: this.points[0].size,\n        pointColor: this.points[0].color\n      };\n    } else {\n      return {\n        order: this.order,\n        tailSize: this.tailSize,\n        smooth: this.smooth,\n        points: (function() {\n          var len, q, ref2, results;\n          ref2 = this.points;\n          results = [];\n          for (q = 0, len = ref2.length; q < len; q++) {\n            p = ref2[q];\n            results.push(shapeToJSON(p));\n          }\n          return results;\n        }).call(this)\n      };\n    }\n  },\n  fromJSON: function(data) {\n    return _createLinePathFromData('LinePath', data);\n  },\n  addPoint: function(point) {\n    this.points.push(point);\n    if (!this.smooth) {\n      this.smoothedPoints = this.points;\n      return;\n    }\n    if (!this.smoothedPoints || this.points.length < this.sampleSize) {\n      return this.smoothedPoints = bspline(this.points, this.order);\n    } else {\n      this.tail = util.last(bspline(util.last(this.points, this.sampleSize), this.order), this.segmentSize * this.tailSize);\n      return this.smoothedPoints = this.smoothedPoints.slice(0, this.smoothedPoints.length - this.segmentSize * (this.tailSize - 1)).concat(this.tail);\n    }\n  },\n  move: function(moveInfo) {\n    var len, pt, pts, q;\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n    if (!this.smooth) {\n      pts = this.points;\n    } else {\n      pts = this.smoothedPoints;\n    }\n    for (q = 0, len = pts.length; q < len; q++) {\n      pt = pts[q];\n      pt.move(moveInfo);\n    }\n    return this.points = this.smoothedPoints;\n  },\n  setUpperLeft: function(upperLeft) {\n    var br, xDiff, yDiff;\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n    br = this.getBoundingRect();\n    xDiff = br.x - upperLeft.x;\n    yDiff = br.y - upperLeft.y;\n    return this.move({\n      xDiff: xDiff,\n      yDiff: yDiff\n    });\n  }\n};\n\nLinePath = defineShape('LinePath', linePathFuncs);\n\ndefineShape('ErasedLinePath', {\n  constructor: linePathFuncs.constructor,\n  toJSON: linePathFuncs.toJSON,\n  addPoint: linePathFuncs.addPoint,\n  getBoundingRect: linePathFuncs.getBoundingRect,\n  fromJSON: function(data) {\n    return _createLinePathFromData('ErasedLinePath', data);\n  }\n});\n\ndefineShape('Point', {\n  constructor: function(args) {\n    if (args == null) {\n      args = {};\n    }\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.size = args.size || 0;\n    return this.color = args.color || '';\n  },\n  getBoundingRect: function() {\n    return {\n      x: this.x - this.size / 2,\n      y: this.y - this.size / 2,\n      width: this.size,\n      height: this.size\n    };\n  },\n  toJSON: function() {\n    return {\n      x: this.x,\n      y: this.y,\n      size: this.size,\n      color: this.color\n    };\n  },\n  fromJSON: function(data) {\n    return createShape('Point', data);\n  },\n  move: function(moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function(upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\n\ndefineShape('Polygon', {\n  constructor: function(args) {\n    var len, point, q, ref2, results;\n    if (args == null) {\n      args = {};\n    }\n    this.points = args.points;\n    this.fillColor = args.fillColor || 'white';\n    this.strokeColor = args.strokeColor || 'black';\n    this.strokeWidth = args.strokeWidth;\n    this.dash = args.dash || null;\n    if (args.isClosed == null) {\n      args.isClosed = true;\n    }\n    this.isClosed = args.isClosed;\n    ref2 = this.points;\n    results = [];\n    for (q = 0, len = ref2.length; q < len; q++) {\n      point = ref2[q];\n      point.color = this.strokeColor;\n      results.push(point.size = this.strokeWidth);\n    }\n    return results;\n  },\n  addPoint: function(x, y) {\n    return this.points.push(LC.createShape('Point', {\n      x: x,\n      y: y\n    }));\n  },\n  getBoundingRect: function() {\n    return util.getBoundingRect(this.points.map(function(p) {\n      return p.getBoundingRect();\n    }));\n  },\n  toJSON: function() {\n    return {\n      strokeWidth: this.strokeWidth,\n      fillColor: this.fillColor,\n      strokeColor: this.strokeColor,\n      dash: this.dash,\n      isClosed: this.isClosed,\n      pointCoordinatePairs: this.points.map(function(p) {\n        return [p.x, p.y];\n      })\n    };\n  },\n  fromJSON: function(data) {\n    data.points = data.pointCoordinatePairs.map(function(arg) {\n      var x, y;\n      x = arg[0], y = arg[1];\n      return createShape('Point', {\n        x: x,\n        y: y,\n        size: data.strokeWidth,\n        color: data.strokeColor\n      });\n    });\n    return createShape('Polygon', data);\n  },\n  move: function(moveInfo) {\n    var len, pt, q, ref2, results;\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n    ref2 = this.points;\n    results = [];\n    for (q = 0, len = ref2.length; q < len; q++) {\n      pt = ref2[q];\n      results.push(pt.move(moveInfo));\n    }\n    return results;\n  },\n  setUpperLeft: function(upperLeft) {\n    var br, xDiff, yDiff;\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n    br = this.getBoundingRect();\n    xDiff = br.x - upperLeft.x;\n    yDiff = br.y - upperLeft.y;\n    return this.move({\n      xDiff: xDiff,\n      yDiff: yDiff\n    });\n  }\n});\n\ndefineShape('Text', {\n  constructor: function(args) {\n    if (args == null) {\n      args = {};\n    }\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this.v = args.v || 0;\n    this.text = args.text || '';\n    this.color = args.color || 'black';\n    this.font = args.font || '18px sans-serif';\n    this.forcedWidth = args.forcedWidth || null;\n    return this.forcedHeight = args.forcedHeight || null;\n  },\n  _makeRenderer: function(ctx) {\n    ctx.lineHeight = 1.2;\n    this.renderer = new TextRenderer(ctx, this.text, this.font, this.forcedWidth, this.forcedHeight);\n    if (this.v < 1) {\n      console.log('repairing baseline');\n      this.v = 1;\n      this.x -= this.renderer.metrics.bounds.minx;\n      return this.y -= this.renderer.metrics.leading - this.renderer.metrics.descent;\n    }\n  },\n  setText: function(text) {\n    this.text = text;\n    return this.renderer = null;\n  },\n  setFont: function(font) {\n    this.font = font;\n    return this.renderer = null;\n  },\n  setPosition: function(x, y) {\n    this.x = x;\n    return this.y = y;\n  },\n  setSize: function(forcedWidth, forcedHeight) {\n    this.forcedWidth = Math.max(forcedWidth, 0);\n    this.forcedHeight = Math.max(forcedHeight, 0);\n    return this.renderer = null;\n  },\n  enforceMaxBoundingRect: function(lc) {\n    var br, dx, lcBoundingRect;\n    br = this.getBoundingRect(lc.ctx);\n    lcBoundingRect = {\n      x: -lc.position.x / lc.scale,\n      y: -lc.position.y / lc.scale,\n      width: lc.canvas.width / lc.scale,\n      height: lc.canvas.height / lc.scale\n    };\n    if (br.x + br.width > lcBoundingRect.x + lcBoundingRect.width) {\n      dx = br.x - lcBoundingRect.x;\n      this.forcedWidth = lcBoundingRect.width - dx - 10;\n      return this.renderer = null;\n    }\n  },\n  getBoundingRect: function(ctx, isEditing) {\n    if (isEditing == null) {\n      isEditing = false;\n    }\n    if (!this.renderer) {\n      if (ctx) {\n        this._makeRenderer(ctx);\n      } else {\n        throw \"Must pass ctx if text hasn't been rendered yet\";\n      }\n    }\n    return {\n      x: Math.floor(this.x),\n      y: Math.floor(this.y),\n      width: Math.ceil(this.renderer.getWidth(true)),\n      height: Math.ceil(this.renderer.getHeight())\n    };\n  },\n  toJSON: function() {\n    return {\n      x: this.x,\n      y: this.y,\n      text: this.text,\n      color: this.color,\n      font: this.font,\n      forcedWidth: this.forcedWidth,\n      forcedHeight: this.forcedHeight,\n      v: this.v\n    };\n  },\n  fromJSON: function(data) {\n    return createShape('Text', data);\n  },\n  move: function(moveInfo) {\n    if (moveInfo == null) {\n      moveInfo = {};\n    }\n    this.x = this.x - moveInfo.xDiff;\n    return this.y = this.y - moveInfo.yDiff;\n  },\n  setUpperLeft: function(upperLeft) {\n    if (upperLeft == null) {\n      upperLeft = {};\n    }\n    this.x = upperLeft.x;\n    return this.y = upperLeft.y;\n  }\n});\n\ndefineShape('SelectionBox', {\n  constructor: function(args) {\n    if (args == null) {\n      args = {};\n    }\n    this.shape = args.shape;\n    if (args.handleSize != null) {\n      this.handleSize = args.handleSize;\n    } else {\n      this.handleSize = 10;\n    }\n    this.margin = 4;\n    this.backgroundColor = args.backgroundColor || null;\n    return this._br = this.shape.getBoundingRect(args.ctx);\n  },\n  toJSON: function() {\n    return {\n      shape: shapeToJSON(this.shape),\n      backgroundColor: this.backgroundColor\n    };\n  },\n  fromJSON: function(arg) {\n    var backgroundColor, handleSize, margin, shape;\n    shape = arg.shape, handleSize = arg.handleSize, margin = arg.margin, backgroundColor = arg.backgroundColor;\n    return createShape('SelectionBox', {\n      shape: JSONToShape(shape),\n      backgroundColor: backgroundColor\n    });\n  },\n  getTopLeftHandleRect: function() {\n    return {\n      x: this._br.x - this.handleSize - this.margin,\n      y: this._br.y - this.handleSize - this.margin,\n      width: this.handleSize,\n      height: this.handleSize\n    };\n  },\n  getBottomLeftHandleRect: function() {\n    return {\n      x: this._br.x - this.handleSize - this.margin,\n      y: this._br.y + this._br.height + this.margin,\n      width: this.handleSize,\n      height: this.handleSize\n    };\n  },\n  getTopRightHandleRect: function() {\n    return {\n      x: this._br.x + this._br.width + this.margin,\n      y: this._br.y - this.handleSize - this.margin,\n      width: this.handleSize,\n      height: this.handleSize\n    };\n  },\n  getBottomRightHandleRect: function() {\n    return {\n      x: this._br.x + this._br.width + this.margin,\n      y: this._br.y + this._br.height + this.margin,\n      width: this.handleSize,\n      height: this.handleSize\n    };\n  },\n  getBoundingRect: function() {\n    return {\n      x: this._br.x - this.margin,\n      y: this._br.y - this.margin,\n      width: this._br.width + this.margin * 2,\n      height: this._br.height + this.margin * 2\n    };\n  }\n});\n\nmodule.exports = {\n  defineShape: defineShape,\n  createShape: createShape,\n  JSONToShape: JSONToShape,\n  shapeToJSON: shapeToJSON\n};\n"]},"metadata":{},"sourceType":"script"}