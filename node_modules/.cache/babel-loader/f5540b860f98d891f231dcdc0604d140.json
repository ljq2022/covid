{"ast":null,"code":"var Polygon,\n    ToolWithStroke,\n    createShape,\n    extend = function (child, parent) {\n  for (var key in parent) {\n    if (hasProp.call(parent, key)) child[key] = parent[key];\n  }\n\n  function ctor() {\n    this.constructor = child;\n  }\n\n  ctor.prototype = parent.prototype;\n  child.prototype = new ctor();\n  child.__super__ = parent.prototype;\n  return child;\n},\n    hasProp = {}.hasOwnProperty;\n\nToolWithStroke = require('./base').ToolWithStroke;\ncreateShape = require('../core/shapes').createShape;\n\nmodule.exports = Polygon = function (superClass) {\n  extend(Polygon, superClass);\n\n  function Polygon() {\n    return Polygon.__super__.constructor.apply(this, arguments);\n  }\n\n  Polygon.prototype.name = 'Polygon';\n  Polygon.prototype.iconName = 'polygon';\n  Polygon.prototype.usesSimpleAPI = false;\n\n  Polygon.prototype.didBecomeActive = function (lc) {\n    var onDown, onMove, onUp, polygonCancel, polygonFinishClosed, polygonFinishOpen, polygonUnsubscribeFuncs;\n\n    Polygon.__super__.didBecomeActive.call(this, lc);\n\n    polygonUnsubscribeFuncs = [];\n\n    this.polygonUnsubscribe = function (_this) {\n      return function () {\n        var func, i, len, results;\n        results = [];\n\n        for (i = 0, len = polygonUnsubscribeFuncs.length; i < len; i++) {\n          func = polygonUnsubscribeFuncs[i];\n          results.push(func());\n        }\n\n        return results;\n      };\n    }(this);\n\n    this.points = null;\n    this.maybePoint = null;\n\n    onUp = function (_this) {\n      return function () {\n        if (_this._getWillFinish()) {\n          return _this._close(lc);\n        }\n\n        lc.trigger('lc-polygon-started');\n\n        if (_this.points) {\n          _this.points.push(_this.maybePoint);\n        } else {\n          _this.points = [_this.maybePoint];\n        }\n\n        _this.maybePoint = {\n          x: _this.maybePoint.x,\n          y: _this.maybePoint.y\n        };\n        lc.setShapesInProgress(_this._getShapes(lc));\n        return lc.repaintLayer('main');\n      };\n    }(this);\n\n    onMove = function (_this) {\n      return function (arg) {\n        var x, y;\n        x = arg.x, y = arg.y;\n\n        if (_this.maybePoint) {\n          _this.maybePoint.x = x;\n          _this.maybePoint.y = y;\n          lc.setShapesInProgress(_this._getShapes(lc));\n          return lc.repaintLayer('main');\n        }\n      };\n    }(this);\n\n    onDown = function (_this) {\n      return function (arg) {\n        var x, y;\n        x = arg.x, y = arg.y;\n        _this.maybePoint = {\n          x: x,\n          y: y\n        };\n        lc.setShapesInProgress(_this._getShapes(lc));\n        return lc.repaintLayer('main');\n      };\n    }(this);\n\n    polygonFinishOpen = function (_this) {\n      return function () {\n        _this.maybePoint = {\n          x: Infinity,\n          y: Infinity\n        };\n        return _this._close(lc);\n      };\n    }(this);\n\n    polygonFinishClosed = function (_this) {\n      return function () {\n        _this.maybePoint = _this.points[0];\n        return _this._close(lc);\n      };\n    }(this);\n\n    polygonCancel = function (_this) {\n      return function () {\n        return _this._cancel(lc);\n      };\n    }(this);\n\n    polygonUnsubscribeFuncs.push(lc.on('drawingChange', function (_this) {\n      return function () {\n        return _this._cancel(lc);\n      };\n    }(this)));\n    polygonUnsubscribeFuncs.push(lc.on('lc-pointerdown', onDown));\n    polygonUnsubscribeFuncs.push(lc.on('lc-pointerdrag', onMove));\n    polygonUnsubscribeFuncs.push(lc.on('lc-pointermove', onMove));\n    polygonUnsubscribeFuncs.push(lc.on('lc-pointerup', onUp));\n    polygonUnsubscribeFuncs.push(lc.on('lc-polygon-finishopen', polygonFinishOpen));\n    polygonUnsubscribeFuncs.push(lc.on('lc-polygon-finishclosed', polygonFinishClosed));\n    return polygonUnsubscribeFuncs.push(lc.on('lc-polygon-cancel', polygonCancel));\n  };\n\n  Polygon.prototype.willBecomeInactive = function (lc) {\n    Polygon.__super__.willBecomeInactive.call(this, lc);\n\n    if (this.points || this.maybePoint) {\n      this._cancel(lc);\n    }\n\n    return this.polygonUnsubscribe();\n  };\n\n  Polygon.prototype._getArePointsClose = function (a, b) {\n    return Math.abs(a.x - b.x) + Math.abs(a.y - b.y) < 10;\n  };\n\n  Polygon.prototype._getWillClose = function () {\n    if (!(this.points && this.points.length > 1)) {\n      return false;\n    }\n\n    if (!this.maybePoint) {\n      return false;\n    }\n\n    return this._getArePointsClose(this.points[0], this.maybePoint);\n  };\n\n  Polygon.prototype._getWillFinish = function () {\n    if (!(this.points && this.points.length > 1)) {\n      return false;\n    }\n\n    if (!this.maybePoint) {\n      return false;\n    }\n\n    return this._getArePointsClose(this.points[0], this.maybePoint) || this._getArePointsClose(this.points[this.points.length - 1], this.maybePoint);\n  };\n\n  Polygon.prototype._cancel = function (lc) {\n    lc.trigger('lc-polygon-stopped');\n    this.maybePoint = null;\n    this.points = null;\n    lc.setShapesInProgress([]);\n    return lc.repaintLayer('main');\n  };\n\n  Polygon.prototype._close = function (lc) {\n    lc.trigger('lc-polygon-stopped');\n    lc.setShapesInProgress([]);\n\n    if (this.points.length > 2) {\n      lc.saveShape(this._getShape(lc, false));\n    }\n\n    this.maybePoint = null;\n    return this.points = null;\n  };\n\n  Polygon.prototype._getShapes = function (lc, isInProgress) {\n    var shape;\n\n    if (isInProgress == null) {\n      isInProgress = true;\n    }\n\n    shape = this._getShape(lc, isInProgress);\n\n    if (shape) {\n      return [shape];\n    } else {\n      return [];\n    }\n  };\n\n  Polygon.prototype._getShape = function (lc, isInProgress) {\n    var points;\n\n    if (isInProgress == null) {\n      isInProgress = true;\n    }\n\n    points = [];\n\n    if (this.points) {\n      points = points.concat(this.points);\n    }\n\n    if (!isInProgress && points.length < 3) {\n      return null;\n    }\n\n    if (isInProgress && this.maybePoint) {\n      points.push(this.maybePoint);\n    }\n\n    if (points.length > 1) {\n      return createShape('Polygon', {\n        isClosed: this._getWillClose(),\n        strokeColor: lc.getColor('primary'),\n        fillColor: lc.getColor('secondary'),\n        strokeWidth: this.strokeWidth,\n        points: points.map(function (xy) {\n          return createShape('Point', xy);\n        })\n      });\n    } else {\n      return null;\n    }\n  };\n\n  Polygon.prototype.optionsStyle = 'polygon-and-stroke-width';\n  return Polygon;\n}(ToolWithStroke);","map":{"version":3,"sources":["C:/Users/lukeq/blog/node_modules/literallycanvas/lib/js/tools/Polygon.js"],"names":["Polygon","ToolWithStroke","createShape","extend","child","parent","key","hasProp","call","ctor","constructor","prototype","__super__","hasOwnProperty","require","module","exports","superClass","apply","arguments","name","iconName","usesSimpleAPI","didBecomeActive","lc","onDown","onMove","onUp","polygonCancel","polygonFinishClosed","polygonFinishOpen","polygonUnsubscribeFuncs","polygonUnsubscribe","_this","func","i","len","results","length","push","points","maybePoint","_getWillFinish","_close","trigger","x","y","setShapesInProgress","_getShapes","repaintLayer","arg","Infinity","_cancel","on","willBecomeInactive","_getArePointsClose","a","b","Math","abs","_getWillClose","saveShape","_getShape","isInProgress","shape","concat","isClosed","strokeColor","getColor","fillColor","strokeWidth","map","xy","optionsStyle"],"mappings":"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","sourcesContent":["var Polygon, ToolWithStroke, createShape,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nToolWithStroke = require('./base').ToolWithStroke;\n\ncreateShape = require('../core/shapes').createShape;\n\nmodule.exports = Polygon = (function(superClass) {\n  extend(Polygon, superClass);\n\n  function Polygon() {\n    return Polygon.__super__.constructor.apply(this, arguments);\n  }\n\n  Polygon.prototype.name = 'Polygon';\n\n  Polygon.prototype.iconName = 'polygon';\n\n  Polygon.prototype.usesSimpleAPI = false;\n\n  Polygon.prototype.didBecomeActive = function(lc) {\n    var onDown, onMove, onUp, polygonCancel, polygonFinishClosed, polygonFinishOpen, polygonUnsubscribeFuncs;\n    Polygon.__super__.didBecomeActive.call(this, lc);\n    polygonUnsubscribeFuncs = [];\n    this.polygonUnsubscribe = (function(_this) {\n      return function() {\n        var func, i, len, results;\n        results = [];\n        for (i = 0, len = polygonUnsubscribeFuncs.length; i < len; i++) {\n          func = polygonUnsubscribeFuncs[i];\n          results.push(func());\n        }\n        return results;\n      };\n    })(this);\n    this.points = null;\n    this.maybePoint = null;\n    onUp = (function(_this) {\n      return function() {\n        if (_this._getWillFinish()) {\n          return _this._close(lc);\n        }\n        lc.trigger('lc-polygon-started');\n        if (_this.points) {\n          _this.points.push(_this.maybePoint);\n        } else {\n          _this.points = [_this.maybePoint];\n        }\n        _this.maybePoint = {\n          x: _this.maybePoint.x,\n          y: _this.maybePoint.y\n        };\n        lc.setShapesInProgress(_this._getShapes(lc));\n        return lc.repaintLayer('main');\n      };\n    })(this);\n    onMove = (function(_this) {\n      return function(arg) {\n        var x, y;\n        x = arg.x, y = arg.y;\n        if (_this.maybePoint) {\n          _this.maybePoint.x = x;\n          _this.maybePoint.y = y;\n          lc.setShapesInProgress(_this._getShapes(lc));\n          return lc.repaintLayer('main');\n        }\n      };\n    })(this);\n    onDown = (function(_this) {\n      return function(arg) {\n        var x, y;\n        x = arg.x, y = arg.y;\n        _this.maybePoint = {\n          x: x,\n          y: y\n        };\n        lc.setShapesInProgress(_this._getShapes(lc));\n        return lc.repaintLayer('main');\n      };\n    })(this);\n    polygonFinishOpen = (function(_this) {\n      return function() {\n        _this.maybePoint = {\n          x: Infinity,\n          y: Infinity\n        };\n        return _this._close(lc);\n      };\n    })(this);\n    polygonFinishClosed = (function(_this) {\n      return function() {\n        _this.maybePoint = _this.points[0];\n        return _this._close(lc);\n      };\n    })(this);\n    polygonCancel = (function(_this) {\n      return function() {\n        return _this._cancel(lc);\n      };\n    })(this);\n    polygonUnsubscribeFuncs.push(lc.on('drawingChange', (function(_this) {\n      return function() {\n        return _this._cancel(lc);\n      };\n    })(this)));\n    polygonUnsubscribeFuncs.push(lc.on('lc-pointerdown', onDown));\n    polygonUnsubscribeFuncs.push(lc.on('lc-pointerdrag', onMove));\n    polygonUnsubscribeFuncs.push(lc.on('lc-pointermove', onMove));\n    polygonUnsubscribeFuncs.push(lc.on('lc-pointerup', onUp));\n    polygonUnsubscribeFuncs.push(lc.on('lc-polygon-finishopen', polygonFinishOpen));\n    polygonUnsubscribeFuncs.push(lc.on('lc-polygon-finishclosed', polygonFinishClosed));\n    return polygonUnsubscribeFuncs.push(lc.on('lc-polygon-cancel', polygonCancel));\n  };\n\n  Polygon.prototype.willBecomeInactive = function(lc) {\n    Polygon.__super__.willBecomeInactive.call(this, lc);\n    if (this.points || this.maybePoint) {\n      this._cancel(lc);\n    }\n    return this.polygonUnsubscribe();\n  };\n\n  Polygon.prototype._getArePointsClose = function(a, b) {\n    return (Math.abs(a.x - b.x) + Math.abs(a.y - b.y)) < 10;\n  };\n\n  Polygon.prototype._getWillClose = function() {\n    if (!(this.points && this.points.length > 1)) {\n      return false;\n    }\n    if (!this.maybePoint) {\n      return false;\n    }\n    return this._getArePointsClose(this.points[0], this.maybePoint);\n  };\n\n  Polygon.prototype._getWillFinish = function() {\n    if (!(this.points && this.points.length > 1)) {\n      return false;\n    }\n    if (!this.maybePoint) {\n      return false;\n    }\n    return this._getArePointsClose(this.points[0], this.maybePoint) || this._getArePointsClose(this.points[this.points.length - 1], this.maybePoint);\n  };\n\n  Polygon.prototype._cancel = function(lc) {\n    lc.trigger('lc-polygon-stopped');\n    this.maybePoint = null;\n    this.points = null;\n    lc.setShapesInProgress([]);\n    return lc.repaintLayer('main');\n  };\n\n  Polygon.prototype._close = function(lc) {\n    lc.trigger('lc-polygon-stopped');\n    lc.setShapesInProgress([]);\n    if (this.points.length > 2) {\n      lc.saveShape(this._getShape(lc, false));\n    }\n    this.maybePoint = null;\n    return this.points = null;\n  };\n\n  Polygon.prototype._getShapes = function(lc, isInProgress) {\n    var shape;\n    if (isInProgress == null) {\n      isInProgress = true;\n    }\n    shape = this._getShape(lc, isInProgress);\n    if (shape) {\n      return [shape];\n    } else {\n      return [];\n    }\n  };\n\n  Polygon.prototype._getShape = function(lc, isInProgress) {\n    var points;\n    if (isInProgress == null) {\n      isInProgress = true;\n    }\n    points = [];\n    if (this.points) {\n      points = points.concat(this.points);\n    }\n    if ((!isInProgress) && points.length < 3) {\n      return null;\n    }\n    if (isInProgress && this.maybePoint) {\n      points.push(this.maybePoint);\n    }\n    if (points.length > 1) {\n      return createShape('Polygon', {\n        isClosed: this._getWillClose(),\n        strokeColor: lc.getColor('primary'),\n        fillColor: lc.getColor('secondary'),\n        strokeWidth: this.strokeWidth,\n        points: points.map(function(xy) {\n          return createShape('Point', xy);\n        })\n      });\n    } else {\n      return null;\n    }\n  };\n\n  Polygon.prototype.optionsStyle = 'polygon-and-stroke-width';\n\n  return Polygon;\n\n})(ToolWithStroke);\n"]},"metadata":{},"sourceType":"script"}