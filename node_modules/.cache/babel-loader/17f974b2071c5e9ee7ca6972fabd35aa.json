{"ast":null,"code":"var _drawRawLinePath, defineCanvasRenderer, drawErasedLinePath, drawErasedLinePathLatest, drawLinePath, drawLinePathLatest, lineEndCapShapes, noop, renderShapeToCanvas, renderShapeToContext, renderers;\n\nlineEndCapShapes = require('./lineEndCapShapes');\nrenderers = {};\n\ndefineCanvasRenderer = function (shapeName, drawFunc, drawLatestFunc) {\n  return renderers[shapeName] = {\n    drawFunc: drawFunc,\n    drawLatestFunc: drawLatestFunc\n  };\n};\n\nnoop = function () {};\n\nrenderShapeToContext = function (ctx, shape, opts) {\n  var bufferCtx;\n\n  if (opts == null) {\n    opts = {};\n  }\n\n  if (opts.shouldIgnoreUnsupportedShapes == null) {\n    opts.shouldIgnoreUnsupportedShapes = false;\n  }\n\n  if (opts.retryCallback == null) {\n    opts.retryCallback = noop;\n  }\n\n  if (opts.shouldOnlyDrawLatest == null) {\n    opts.shouldOnlyDrawLatest = false;\n  }\n\n  if (opts.bufferCtx == null) {\n    opts.bufferCtx = null;\n  }\n\n  bufferCtx = opts.bufferCtx;\n\n  if (renderers[shape.className]) {\n    if (opts.shouldOnlyDrawLatest && renderers[shape.className].drawLatestFunc) {\n      return renderers[shape.className].drawLatestFunc(ctx, bufferCtx, shape, opts.retryCallback);\n    } else {\n      return renderers[shape.className].drawFunc(ctx, shape, opts.retryCallback);\n    }\n  } else if (opts.shouldIgnoreUnsupportedShapes) {\n    return console.warn(\"Can't render shape of type \" + shape.className + \" to canvas\");\n  } else {\n    throw \"Can't render shape of type \" + shape.className + \" to canvas\";\n  }\n};\n\nrenderShapeToCanvas = function (canvas, shape, opts) {\n  return renderShapeToContext(canvas.getContext('2d'), shape, opts);\n};\n\ndefineCanvasRenderer('Rectangle', function (ctx, shape) {\n  var x, y;\n  x = shape.x;\n  y = shape.y;\n\n  if (shape.strokeWidth % 2 !== 0) {\n    x += 0.5;\n    y += 0.5;\n  }\n\n  ctx.fillStyle = shape.fillColor;\n  ctx.fillRect(x, y, shape.width, shape.height);\n  ctx.lineWidth = shape.strokeWidth;\n  ctx.strokeStyle = shape.strokeColor;\n  return ctx.strokeRect(x, y, shape.width, shape.height);\n});\ndefineCanvasRenderer('Ellipse', function (ctx, shape) {\n  var centerX, centerY, halfHeight, halfWidth;\n  ctx.save();\n  halfWidth = Math.floor(shape.width / 2);\n  halfHeight = Math.floor(shape.height / 2);\n  centerX = shape.x + halfWidth;\n  centerY = shape.y + halfHeight;\n  ctx.translate(centerX, centerY);\n  ctx.scale(1, Math.abs(shape.height / shape.width));\n  ctx.beginPath();\n  ctx.arc(0, 0, Math.abs(halfWidth), 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.restore();\n  ctx.fillStyle = shape.fillColor;\n  ctx.fill();\n  ctx.lineWidth = shape.strokeWidth;\n  ctx.strokeStyle = shape.strokeColor;\n  return ctx.stroke();\n});\ndefineCanvasRenderer('SelectionBox', function () {\n  var _drawHandle;\n\n  _drawHandle = function (ctx, arg, handleSize) {\n    var x, y;\n    x = arg.x, y = arg.y;\n\n    if (handleSize === 0) {\n      return;\n    }\n\n    ctx.fillStyle = '#fff';\n    ctx.fillRect(x, y, handleSize, handleSize);\n    ctx.strokeStyle = '#000';\n    return ctx.strokeRect(x, y, handleSize, handleSize);\n  };\n\n  return function (ctx, shape) {\n    _drawHandle(ctx, shape.getTopLeftHandleRect(), shape.handleSize);\n\n    _drawHandle(ctx, shape.getTopRightHandleRect(), shape.handleSize);\n\n    _drawHandle(ctx, shape.getBottomLeftHandleRect(), shape.handleSize);\n\n    _drawHandle(ctx, shape.getBottomRightHandleRect(), shape.handleSize);\n\n    if (shape.backgroundColor) {\n      ctx.fillStyle = shape.backgroundColor;\n      ctx.fillRect(shape._br.x - shape.margin, shape._br.y - shape.margin, shape._br.width + shape.margin * 2, shape._br.height + shape.margin * 2);\n    }\n\n    ctx.lineWidth = 1;\n    ctx.strokeStyle = '#000';\n    ctx.setLineDash([2, 4]);\n    ctx.strokeRect(shape._br.x - shape.margin, shape._br.y - shape.margin, shape._br.width + shape.margin * 2, shape._br.height + shape.margin * 2);\n    return ctx.setLineDash([]);\n  };\n}());\ndefineCanvasRenderer('Image', function (ctx, shape, retryCallback) {\n  if (shape.image.width) {\n    if (shape.scale === 1) {\n      return ctx.drawImage(shape.image, shape.x, shape.y);\n    } else {\n      return ctx.drawImage(shape.image, shape.x, shape.y, shape.image.width * shape.scale, shape.image.height * shape.scale);\n    }\n  } else if (retryCallback) {\n    return shape.image.onload = retryCallback;\n  }\n});\ndefineCanvasRenderer('Line', function (ctx, shape) {\n  var arrowWidth, x1, x2, y1, y2;\n\n  if (shape.x1 === shape.x2 && shape.y1 === shape.y2) {\n    return;\n  }\n\n  x1 = shape.x1;\n  x2 = shape.x2;\n  y1 = shape.y1;\n  y2 = shape.y2;\n\n  if (shape.strokeWidth % 2 !== 0) {\n    x1 += 0.5;\n    x2 += 0.5;\n    y1 += 0.5;\n    y2 += 0.5;\n  }\n\n  ctx.lineWidth = shape.strokeWidth;\n  ctx.strokeStyle = shape.color;\n  ctx.lineCap = shape.capStyle;\n\n  if (shape.dash) {\n    ctx.setLineDash(shape.dash);\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.stroke();\n\n  if (shape.dash) {\n    ctx.setLineDash([]);\n  }\n\n  arrowWidth = Math.max(shape.strokeWidth * 2.2, 5);\n\n  if (shape.endCapShapes[0]) {\n    lineEndCapShapes[shape.endCapShapes[0]].drawToCanvas(ctx, x1, y1, Math.atan2(y1 - y2, x1 - x2), arrowWidth, shape.color);\n  }\n\n  if (shape.endCapShapes[1]) {\n    return lineEndCapShapes[shape.endCapShapes[1]].drawToCanvas(ctx, x2, y2, Math.atan2(y2 - y1, x2 - x1), arrowWidth, shape.color);\n  }\n});\n\n_drawRawLinePath = function (ctx, points, close, lineCap) {\n  var i, len, point, ref;\n\n  if (close == null) {\n    close = false;\n  }\n\n  if (lineCap == null) {\n    lineCap = 'round';\n  }\n\n  if (!points.length) {\n    return;\n  }\n\n  ctx.lineCap = lineCap;\n  ctx.strokeStyle = points[0].color;\n  ctx.lineWidth = points[0].size;\n  ctx.beginPath();\n\n  if (points[0].size % 2 === 0) {\n    ctx.moveTo(points[0].x, points[0].y);\n  } else {\n    ctx.moveTo(points[0].x + 0.5, points[0].y + 0.5);\n  }\n\n  ref = points.slice(1);\n\n  for (i = 0, len = ref.length; i < len; i++) {\n    point = ref[i];\n\n    if (points[0].size % 2 === 0) {\n      ctx.lineTo(point.x, point.y);\n    } else {\n      ctx.lineTo(point.x + 0.5, point.y + 0.5);\n    }\n  }\n\n  if (close) {\n    return ctx.closePath();\n  }\n};\n\ndrawLinePath = function (ctx, shape) {\n  _drawRawLinePath(ctx, shape.smoothedPoints);\n\n  return ctx.stroke();\n};\n\ndrawLinePathLatest = function (ctx, bufferCtx, shape) {\n  var drawEnd, drawStart, segmentStart;\n\n  if (shape.tail) {\n    segmentStart = shape.smoothedPoints.length - shape.segmentSize * shape.tailSize;\n    drawStart = segmentStart < shape.segmentSize * 2 ? 0 : segmentStart;\n    drawEnd = segmentStart + shape.segmentSize + 1;\n\n    _drawRawLinePath(bufferCtx, shape.smoothedPoints.slice(drawStart, drawEnd));\n\n    return bufferCtx.stroke();\n  } else {\n    _drawRawLinePath(bufferCtx, shape.smoothedPoints);\n\n    return bufferCtx.stroke();\n  }\n};\n\ndefineCanvasRenderer('LinePath', drawLinePath, drawLinePathLatest);\n\ndrawErasedLinePath = function (ctx, shape) {\n  ctx.save();\n  ctx.globalCompositeOperation = \"destination-out\";\n  drawLinePath(ctx, shape);\n  return ctx.restore();\n};\n\ndrawErasedLinePathLatest = function (ctx, bufferCtx, shape) {\n  ctx.save();\n  ctx.globalCompositeOperation = \"destination-out\";\n  bufferCtx.save();\n  bufferCtx.globalCompositeOperation = \"destination-out\";\n  drawLinePathLatest(ctx, bufferCtx, shape);\n  ctx.restore();\n  return bufferCtx.restore();\n};\n\ndefineCanvasRenderer('ErasedLinePath', drawErasedLinePath, drawErasedLinePathLatest);\ndefineCanvasRenderer('Text', function (ctx, shape) {\n  if (!shape.renderer) {\n    shape._makeRenderer(ctx);\n  }\n\n  ctx.fillStyle = shape.color;\n  return shape.renderer.draw(ctx, shape.x, shape.y);\n});\ndefineCanvasRenderer('Polygon', function (ctx, shape) {\n  ctx.fillStyle = shape.fillColor;\n\n  _drawRawLinePath(ctx, shape.points, shape.isClosed, 'butt');\n\n  ctx.fill();\n  return ctx.stroke();\n});\nmodule.exports = {\n  defineCanvasRenderer: defineCanvasRenderer,\n  renderShapeToCanvas: renderShapeToCanvas,\n  renderShapeToContext: renderShapeToContext\n};","map":{"version":3,"sources":["C:/Users/lukeq/blog/node_modules/literallycanvas/lib/js/core/canvasRenderer.js"],"names":["_drawRawLinePath","defineCanvasRenderer","drawErasedLinePath","drawErasedLinePathLatest","drawLinePath","drawLinePathLatest","lineEndCapShapes","noop","renderShapeToCanvas","renderShapeToContext","renderers","require","shapeName","drawFunc","drawLatestFunc","ctx","shape","opts","bufferCtx","shouldIgnoreUnsupportedShapes","retryCallback","shouldOnlyDrawLatest","className","console","warn","canvas","getContext","x","y","strokeWidth","fillStyle","fillColor","fillRect","width","height","lineWidth","strokeStyle","strokeColor","strokeRect","centerX","centerY","halfHeight","halfWidth","save","Math","floor","translate","scale","abs","beginPath","arc","PI","closePath","restore","fill","stroke","_drawHandle","arg","handleSize","getTopLeftHandleRect","getTopRightHandleRect","getBottomLeftHandleRect","getBottomRightHandleRect","backgroundColor","_br","margin","setLineDash","image","drawImage","onload","arrowWidth","x1","x2","y1","y2","color","lineCap","capStyle","dash","moveTo","lineTo","max","endCapShapes","drawToCanvas","atan2","points","close","i","len","point","ref","length","size","slice","smoothedPoints","drawEnd","drawStart","segmentStart","tail","segmentSize","tailSize","globalCompositeOperation","renderer","_makeRenderer","draw","isClosed","module","exports"],"mappings":"AAAA,IAAIA,gBAAJ,EAAsBC,oBAAtB,EAA4CC,kBAA5C,EAAgEC,wBAAhE,EAA0FC,YAA1F,EAAwGC,kBAAxG,EAA4HC,gBAA5H,EAA8IC,IAA9I,EAAoJC,mBAApJ,EAAyKC,oBAAzK,EAA+LC,SAA/L;;AAEAJ,gBAAgB,GAAGK,OAAO,CAAC,oBAAD,CAA1B;AAEAD,SAAS,GAAG,EAAZ;;AAEAT,oBAAoB,GAAG,UAASW,SAAT,EAAoBC,QAApB,EAA8BC,cAA9B,EAA8C;AACnE,SAAOJ,SAAS,CAACE,SAAD,CAAT,GAAuB;AAC5BC,IAAAA,QAAQ,EAAEA,QADkB;AAE5BC,IAAAA,cAAc,EAAEA;AAFY,GAA9B;AAID,CALD;;AAOAP,IAAI,GAAG,YAAW,CAAE,CAApB;;AAEAE,oBAAoB,GAAG,UAASM,GAAT,EAAcC,KAAd,EAAqBC,IAArB,EAA2B;AAChD,MAAIC,SAAJ;;AACA,MAAID,IAAI,IAAI,IAAZ,EAAkB;AAChBA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACD,MAAIA,IAAI,CAACE,6BAAL,IAAsC,IAA1C,EAAgD;AAC9CF,IAAAA,IAAI,CAACE,6BAAL,GAAqC,KAArC;AACD;;AACD,MAAIF,IAAI,CAACG,aAAL,IAAsB,IAA1B,EAAgC;AAC9BH,IAAAA,IAAI,CAACG,aAAL,GAAqBb,IAArB;AACD;;AACD,MAAIU,IAAI,CAACI,oBAAL,IAA6B,IAAjC,EAAuC;AACrCJ,IAAAA,IAAI,CAACI,oBAAL,GAA4B,KAA5B;AACD;;AACD,MAAIJ,IAAI,CAACC,SAAL,IAAkB,IAAtB,EAA4B;AAC1BD,IAAAA,IAAI,CAACC,SAAL,GAAiB,IAAjB;AACD;;AACDA,EAAAA,SAAS,GAAGD,IAAI,CAACC,SAAjB;;AACA,MAAIR,SAAS,CAACM,KAAK,CAACM,SAAP,CAAb,EAAgC;AAC9B,QAAIL,IAAI,CAACI,oBAAL,IAA6BX,SAAS,CAACM,KAAK,CAACM,SAAP,CAAT,CAA2BR,cAA5D,EAA4E;AAC1E,aAAOJ,SAAS,CAACM,KAAK,CAACM,SAAP,CAAT,CAA2BR,cAA3B,CAA0CC,GAA1C,EAA+CG,SAA/C,EAA0DF,KAA1D,EAAiEC,IAAI,CAACG,aAAtE,CAAP;AACD,KAFD,MAEO;AACL,aAAOV,SAAS,CAACM,KAAK,CAACM,SAAP,CAAT,CAA2BT,QAA3B,CAAoCE,GAApC,EAAyCC,KAAzC,EAAgDC,IAAI,CAACG,aAArD,CAAP;AACD;AACF,GAND,MAMO,IAAIH,IAAI,CAACE,6BAAT,EAAwC;AAC7C,WAAOI,OAAO,CAACC,IAAR,CAAa,gCAAgCR,KAAK,CAACM,SAAtC,GAAkD,YAA/D,CAAP;AACD,GAFM,MAEA;AACL,UAAM,gCAAgCN,KAAK,CAACM,SAAtC,GAAkD,YAAxD;AACD;AACF,CA7BD;;AA+BAd,mBAAmB,GAAG,UAASiB,MAAT,EAAiBT,KAAjB,EAAwBC,IAAxB,EAA8B;AAClD,SAAOR,oBAAoB,CAACgB,MAAM,CAACC,UAAP,CAAkB,IAAlB,CAAD,EAA0BV,KAA1B,EAAiCC,IAAjC,CAA3B;AACD,CAFD;;AAIAhB,oBAAoB,CAAC,WAAD,EAAc,UAASc,GAAT,EAAcC,KAAd,EAAqB;AACrD,MAAIW,CAAJ,EAAOC,CAAP;AACAD,EAAAA,CAAC,GAAGX,KAAK,CAACW,CAAV;AACAC,EAAAA,CAAC,GAAGZ,KAAK,CAACY,CAAV;;AACA,MAAIZ,KAAK,CAACa,WAAN,GAAoB,CAApB,KAA0B,CAA9B,EAAiC;AAC/BF,IAAAA,CAAC,IAAI,GAAL;AACAC,IAAAA,CAAC,IAAI,GAAL;AACD;;AACDb,EAAAA,GAAG,CAACe,SAAJ,GAAgBd,KAAK,CAACe,SAAtB;AACAhB,EAAAA,GAAG,CAACiB,QAAJ,CAAaL,CAAb,EAAgBC,CAAhB,EAAmBZ,KAAK,CAACiB,KAAzB,EAAgCjB,KAAK,CAACkB,MAAtC;AACAnB,EAAAA,GAAG,CAACoB,SAAJ,GAAgBnB,KAAK,CAACa,WAAtB;AACAd,EAAAA,GAAG,CAACqB,WAAJ,GAAkBpB,KAAK,CAACqB,WAAxB;AACA,SAAOtB,GAAG,CAACuB,UAAJ,CAAeX,CAAf,EAAkBC,CAAlB,EAAqBZ,KAAK,CAACiB,KAA3B,EAAkCjB,KAAK,CAACkB,MAAxC,CAAP;AACD,CAbmB,CAApB;AAeAjC,oBAAoB,CAAC,SAAD,EAAY,UAASc,GAAT,EAAcC,KAAd,EAAqB;AACnD,MAAIuB,OAAJ,EAAaC,OAAb,EAAsBC,UAAtB,EAAkCC,SAAlC;AACA3B,EAAAA,GAAG,CAAC4B,IAAJ;AACAD,EAAAA,SAAS,GAAGE,IAAI,CAACC,KAAL,CAAW7B,KAAK,CAACiB,KAAN,GAAc,CAAzB,CAAZ;AACAQ,EAAAA,UAAU,GAAGG,IAAI,CAACC,KAAL,CAAW7B,KAAK,CAACkB,MAAN,GAAe,CAA1B,CAAb;AACAK,EAAAA,OAAO,GAAGvB,KAAK,CAACW,CAAN,GAAUe,SAApB;AACAF,EAAAA,OAAO,GAAGxB,KAAK,CAACY,CAAN,GAAUa,UAApB;AACA1B,EAAAA,GAAG,CAAC+B,SAAJ,CAAcP,OAAd,EAAuBC,OAAvB;AACAzB,EAAAA,GAAG,CAACgC,KAAJ,CAAU,CAAV,EAAaH,IAAI,CAACI,GAAL,CAAShC,KAAK,CAACkB,MAAN,GAAelB,KAAK,CAACiB,KAA9B,CAAb;AACAlB,EAAAA,GAAG,CAACkC,SAAJ;AACAlC,EAAAA,GAAG,CAACmC,GAAJ,CAAQ,CAAR,EAAW,CAAX,EAAcN,IAAI,CAACI,GAAL,CAASN,SAAT,CAAd,EAAmC,CAAnC,EAAsCE,IAAI,CAACO,EAAL,GAAU,CAAhD;AACApC,EAAAA,GAAG,CAACqC,SAAJ;AACArC,EAAAA,GAAG,CAACsC,OAAJ;AACAtC,EAAAA,GAAG,CAACe,SAAJ,GAAgBd,KAAK,CAACe,SAAtB;AACAhB,EAAAA,GAAG,CAACuC,IAAJ;AACAvC,EAAAA,GAAG,CAACoB,SAAJ,GAAgBnB,KAAK,CAACa,WAAtB;AACAd,EAAAA,GAAG,CAACqB,WAAJ,GAAkBpB,KAAK,CAACqB,WAAxB;AACA,SAAOtB,GAAG,CAACwC,MAAJ,EAAP;AACD,CAlBmB,CAApB;AAoBAtD,oBAAoB,CAAC,cAAD,EAAkB,YAAW;AAC/C,MAAIuD,WAAJ;;AACAA,EAAAA,WAAW,GAAG,UAASzC,GAAT,EAAc0C,GAAd,EAAmBC,UAAnB,EAA+B;AAC3C,QAAI/B,CAAJ,EAAOC,CAAP;AACAD,IAAAA,CAAC,GAAG8B,GAAG,CAAC9B,CAAR,EAAWC,CAAC,GAAG6B,GAAG,CAAC7B,CAAnB;;AACA,QAAI8B,UAAU,KAAK,CAAnB,EAAsB;AACpB;AACD;;AACD3C,IAAAA,GAAG,CAACe,SAAJ,GAAgB,MAAhB;AACAf,IAAAA,GAAG,CAACiB,QAAJ,CAAaL,CAAb,EAAgBC,CAAhB,EAAmB8B,UAAnB,EAA+BA,UAA/B;AACA3C,IAAAA,GAAG,CAACqB,WAAJ,GAAkB,MAAlB;AACA,WAAOrB,GAAG,CAACuB,UAAJ,CAAeX,CAAf,EAAkBC,CAAlB,EAAqB8B,UAArB,EAAiCA,UAAjC,CAAP;AACD,GAVD;;AAWA,SAAO,UAAS3C,GAAT,EAAcC,KAAd,EAAqB;AAC1BwC,IAAAA,WAAW,CAACzC,GAAD,EAAMC,KAAK,CAAC2C,oBAAN,EAAN,EAAoC3C,KAAK,CAAC0C,UAA1C,CAAX;;AACAF,IAAAA,WAAW,CAACzC,GAAD,EAAMC,KAAK,CAAC4C,qBAAN,EAAN,EAAqC5C,KAAK,CAAC0C,UAA3C,CAAX;;AACAF,IAAAA,WAAW,CAACzC,GAAD,EAAMC,KAAK,CAAC6C,uBAAN,EAAN,EAAuC7C,KAAK,CAAC0C,UAA7C,CAAX;;AACAF,IAAAA,WAAW,CAACzC,GAAD,EAAMC,KAAK,CAAC8C,wBAAN,EAAN,EAAwC9C,KAAK,CAAC0C,UAA9C,CAAX;;AACA,QAAI1C,KAAK,CAAC+C,eAAV,EAA2B;AACzBhD,MAAAA,GAAG,CAACe,SAAJ,GAAgBd,KAAK,CAAC+C,eAAtB;AACAhD,MAAAA,GAAG,CAACiB,QAAJ,CAAahB,KAAK,CAACgD,GAAN,CAAUrC,CAAV,GAAcX,KAAK,CAACiD,MAAjC,EAAyCjD,KAAK,CAACgD,GAAN,CAAUpC,CAAV,GAAcZ,KAAK,CAACiD,MAA7D,EAAqEjD,KAAK,CAACgD,GAAN,CAAU/B,KAAV,GAAkBjB,KAAK,CAACiD,MAAN,GAAe,CAAtG,EAAyGjD,KAAK,CAACgD,GAAN,CAAU9B,MAAV,GAAmBlB,KAAK,CAACiD,MAAN,GAAe,CAA3I;AACD;;AACDlD,IAAAA,GAAG,CAACoB,SAAJ,GAAgB,CAAhB;AACApB,IAAAA,GAAG,CAACqB,WAAJ,GAAkB,MAAlB;AACArB,IAAAA,GAAG,CAACmD,WAAJ,CAAgB,CAAC,CAAD,EAAI,CAAJ,CAAhB;AACAnD,IAAAA,GAAG,CAACuB,UAAJ,CAAetB,KAAK,CAACgD,GAAN,CAAUrC,CAAV,GAAcX,KAAK,CAACiD,MAAnC,EAA2CjD,KAAK,CAACgD,GAAN,CAAUpC,CAAV,GAAcZ,KAAK,CAACiD,MAA/D,EAAuEjD,KAAK,CAACgD,GAAN,CAAU/B,KAAV,GAAkBjB,KAAK,CAACiD,MAAN,GAAe,CAAxG,EAA2GjD,KAAK,CAACgD,GAAN,CAAU9B,MAAV,GAAmBlB,KAAK,CAACiD,MAAN,GAAe,CAA7I;AACA,WAAOlD,GAAG,CAACmD,WAAJ,CAAgB,EAAhB,CAAP;AACD,GAdD;AAeD,CA5BoC,EAAjB,CAApB;AA8BAjE,oBAAoB,CAAC,OAAD,EAAU,UAASc,GAAT,EAAcC,KAAd,EAAqBI,aAArB,EAAoC;AAChE,MAAIJ,KAAK,CAACmD,KAAN,CAAYlC,KAAhB,EAAuB;AACrB,QAAIjB,KAAK,CAAC+B,KAAN,KAAgB,CAApB,EAAuB;AACrB,aAAOhC,GAAG,CAACqD,SAAJ,CAAcpD,KAAK,CAACmD,KAApB,EAA2BnD,KAAK,CAACW,CAAjC,EAAoCX,KAAK,CAACY,CAA1C,CAAP;AACD,KAFD,MAEO;AACL,aAAOb,GAAG,CAACqD,SAAJ,CAAcpD,KAAK,CAACmD,KAApB,EAA2BnD,KAAK,CAACW,CAAjC,EAAoCX,KAAK,CAACY,CAA1C,EAA6CZ,KAAK,CAACmD,KAAN,CAAYlC,KAAZ,GAAoBjB,KAAK,CAAC+B,KAAvE,EAA8E/B,KAAK,CAACmD,KAAN,CAAYjC,MAAZ,GAAqBlB,KAAK,CAAC+B,KAAzG,CAAP;AACD;AACF,GAND,MAMO,IAAI3B,aAAJ,EAAmB;AACxB,WAAOJ,KAAK,CAACmD,KAAN,CAAYE,MAAZ,GAAqBjD,aAA5B;AACD;AACF,CAVmB,CAApB;AAYAnB,oBAAoB,CAAC,MAAD,EAAS,UAASc,GAAT,EAAcC,KAAd,EAAqB;AAChD,MAAIsD,UAAJ,EAAgBC,EAAhB,EAAoBC,EAApB,EAAwBC,EAAxB,EAA4BC,EAA5B;;AACA,MAAI1D,KAAK,CAACuD,EAAN,KAAavD,KAAK,CAACwD,EAAnB,IAAyBxD,KAAK,CAACyD,EAAN,KAAazD,KAAK,CAAC0D,EAAhD,EAAoD;AAClD;AACD;;AACDH,EAAAA,EAAE,GAAGvD,KAAK,CAACuD,EAAX;AACAC,EAAAA,EAAE,GAAGxD,KAAK,CAACwD,EAAX;AACAC,EAAAA,EAAE,GAAGzD,KAAK,CAACyD,EAAX;AACAC,EAAAA,EAAE,GAAG1D,KAAK,CAAC0D,EAAX;;AACA,MAAI1D,KAAK,CAACa,WAAN,GAAoB,CAApB,KAA0B,CAA9B,EAAiC;AAC/B0C,IAAAA,EAAE,IAAI,GAAN;AACAC,IAAAA,EAAE,IAAI,GAAN;AACAC,IAAAA,EAAE,IAAI,GAAN;AACAC,IAAAA,EAAE,IAAI,GAAN;AACD;;AACD3D,EAAAA,GAAG,CAACoB,SAAJ,GAAgBnB,KAAK,CAACa,WAAtB;AACAd,EAAAA,GAAG,CAACqB,WAAJ,GAAkBpB,KAAK,CAAC2D,KAAxB;AACA5D,EAAAA,GAAG,CAAC6D,OAAJ,GAAc5D,KAAK,CAAC6D,QAApB;;AACA,MAAI7D,KAAK,CAAC8D,IAAV,EAAgB;AACd/D,IAAAA,GAAG,CAACmD,WAAJ,CAAgBlD,KAAK,CAAC8D,IAAtB;AACD;;AACD/D,EAAAA,GAAG,CAACkC,SAAJ;AACAlC,EAAAA,GAAG,CAACgE,MAAJ,CAAWR,EAAX,EAAeE,EAAf;AACA1D,EAAAA,GAAG,CAACiE,MAAJ,CAAWR,EAAX,EAAeE,EAAf;AACA3D,EAAAA,GAAG,CAACwC,MAAJ;;AACA,MAAIvC,KAAK,CAAC8D,IAAV,EAAgB;AACd/D,IAAAA,GAAG,CAACmD,WAAJ,CAAgB,EAAhB;AACD;;AACDI,EAAAA,UAAU,GAAG1B,IAAI,CAACqC,GAAL,CAASjE,KAAK,CAACa,WAAN,GAAoB,GAA7B,EAAkC,CAAlC,CAAb;;AACA,MAAIb,KAAK,CAACkE,YAAN,CAAmB,CAAnB,CAAJ,EAA2B;AACzB5E,IAAAA,gBAAgB,CAACU,KAAK,CAACkE,YAAN,CAAmB,CAAnB,CAAD,CAAhB,CAAwCC,YAAxC,CAAqDpE,GAArD,EAA0DwD,EAA1D,EAA8DE,EAA9D,EAAkE7B,IAAI,CAACwC,KAAL,CAAWX,EAAE,GAAGC,EAAhB,EAAoBH,EAAE,GAAGC,EAAzB,CAAlE,EAAgGF,UAAhG,EAA4GtD,KAAK,CAAC2D,KAAlH;AACD;;AACD,MAAI3D,KAAK,CAACkE,YAAN,CAAmB,CAAnB,CAAJ,EAA2B;AACzB,WAAO5E,gBAAgB,CAACU,KAAK,CAACkE,YAAN,CAAmB,CAAnB,CAAD,CAAhB,CAAwCC,YAAxC,CAAqDpE,GAArD,EAA0DyD,EAA1D,EAA8DE,EAA9D,EAAkE9B,IAAI,CAACwC,KAAL,CAAWV,EAAE,GAAGD,EAAhB,EAAoBD,EAAE,GAAGD,EAAzB,CAAlE,EAAgGD,UAAhG,EAA4GtD,KAAK,CAAC2D,KAAlH,CAAP;AACD;AACF,CAnCmB,CAApB;;AAqCA3E,gBAAgB,GAAG,UAASe,GAAT,EAAcsE,MAAd,EAAsBC,KAAtB,EAA6BV,OAA7B,EAAsC;AACvD,MAAIW,CAAJ,EAAOC,GAAP,EAAYC,KAAZ,EAAmBC,GAAnB;;AACA,MAAIJ,KAAK,IAAI,IAAb,EAAmB;AACjBA,IAAAA,KAAK,GAAG,KAAR;AACD;;AACD,MAAIV,OAAO,IAAI,IAAf,EAAqB;AACnBA,IAAAA,OAAO,GAAG,OAAV;AACD;;AACD,MAAI,CAACS,MAAM,CAACM,MAAZ,EAAoB;AAClB;AACD;;AACD5E,EAAAA,GAAG,CAAC6D,OAAJ,GAAcA,OAAd;AACA7D,EAAAA,GAAG,CAACqB,WAAJ,GAAkBiD,MAAM,CAAC,CAAD,CAAN,CAAUV,KAA5B;AACA5D,EAAAA,GAAG,CAACoB,SAAJ,GAAgBkD,MAAM,CAAC,CAAD,CAAN,CAAUO,IAA1B;AACA7E,EAAAA,GAAG,CAACkC,SAAJ;;AACA,MAAIoC,MAAM,CAAC,CAAD,CAAN,CAAUO,IAAV,GAAiB,CAAjB,KAAuB,CAA3B,EAA8B;AAC5B7E,IAAAA,GAAG,CAACgE,MAAJ,CAAWM,MAAM,CAAC,CAAD,CAAN,CAAU1D,CAArB,EAAwB0D,MAAM,CAAC,CAAD,CAAN,CAAUzD,CAAlC;AACD,GAFD,MAEO;AACLb,IAAAA,GAAG,CAACgE,MAAJ,CAAWM,MAAM,CAAC,CAAD,CAAN,CAAU1D,CAAV,GAAc,GAAzB,EAA8B0D,MAAM,CAAC,CAAD,CAAN,CAAUzD,CAAV,GAAc,GAA5C;AACD;;AACD8D,EAAAA,GAAG,GAAGL,MAAM,CAACQ,KAAP,CAAa,CAAb,CAAN;;AACA,OAAKN,CAAC,GAAG,CAAJ,EAAOC,GAAG,GAAGE,GAAG,CAACC,MAAtB,EAA8BJ,CAAC,GAAGC,GAAlC,EAAuCD,CAAC,EAAxC,EAA4C;AAC1CE,IAAAA,KAAK,GAAGC,GAAG,CAACH,CAAD,CAAX;;AACA,QAAIF,MAAM,CAAC,CAAD,CAAN,CAAUO,IAAV,GAAiB,CAAjB,KAAuB,CAA3B,EAA8B;AAC5B7E,MAAAA,GAAG,CAACiE,MAAJ,CAAWS,KAAK,CAAC9D,CAAjB,EAAoB8D,KAAK,CAAC7D,CAA1B;AACD,KAFD,MAEO;AACLb,MAAAA,GAAG,CAACiE,MAAJ,CAAWS,KAAK,CAAC9D,CAAN,GAAU,GAArB,EAA0B8D,KAAK,CAAC7D,CAAN,GAAU,GAApC;AACD;AACF;;AACD,MAAI0D,KAAJ,EAAW;AACT,WAAOvE,GAAG,CAACqC,SAAJ,EAAP;AACD;AACF,CAhCD;;AAkCAhD,YAAY,GAAG,UAASW,GAAT,EAAcC,KAAd,EAAqB;AAClChB,EAAAA,gBAAgB,CAACe,GAAD,EAAMC,KAAK,CAAC8E,cAAZ,CAAhB;;AACA,SAAO/E,GAAG,CAACwC,MAAJ,EAAP;AACD,CAHD;;AAKAlD,kBAAkB,GAAG,UAASU,GAAT,EAAcG,SAAd,EAAyBF,KAAzB,EAAgC;AACnD,MAAI+E,OAAJ,EAAaC,SAAb,EAAwBC,YAAxB;;AACA,MAAIjF,KAAK,CAACkF,IAAV,EAAgB;AACdD,IAAAA,YAAY,GAAGjF,KAAK,CAAC8E,cAAN,CAAqBH,MAArB,GAA8B3E,KAAK,CAACmF,WAAN,GAAoBnF,KAAK,CAACoF,QAAvE;AACAJ,IAAAA,SAAS,GAAGC,YAAY,GAAGjF,KAAK,CAACmF,WAAN,GAAoB,CAAnC,GAAuC,CAAvC,GAA2CF,YAAvD;AACAF,IAAAA,OAAO,GAAGE,YAAY,GAAGjF,KAAK,CAACmF,WAArB,GAAmC,CAA7C;;AACAnG,IAAAA,gBAAgB,CAACkB,SAAD,EAAYF,KAAK,CAAC8E,cAAN,CAAqBD,KAArB,CAA2BG,SAA3B,EAAsCD,OAAtC,CAAZ,CAAhB;;AACA,WAAO7E,SAAS,CAACqC,MAAV,EAAP;AACD,GAND,MAMO;AACLvD,IAAAA,gBAAgB,CAACkB,SAAD,EAAYF,KAAK,CAAC8E,cAAlB,CAAhB;;AACA,WAAO5E,SAAS,CAACqC,MAAV,EAAP;AACD;AACF,CAZD;;AAcAtD,oBAAoB,CAAC,UAAD,EAAaG,YAAb,EAA2BC,kBAA3B,CAApB;;AAEAH,kBAAkB,GAAG,UAASa,GAAT,EAAcC,KAAd,EAAqB;AACxCD,EAAAA,GAAG,CAAC4B,IAAJ;AACA5B,EAAAA,GAAG,CAACsF,wBAAJ,GAA+B,iBAA/B;AACAjG,EAAAA,YAAY,CAACW,GAAD,EAAMC,KAAN,CAAZ;AACA,SAAOD,GAAG,CAACsC,OAAJ,EAAP;AACD,CALD;;AAOAlD,wBAAwB,GAAG,UAASY,GAAT,EAAcG,SAAd,EAAyBF,KAAzB,EAAgC;AACzDD,EAAAA,GAAG,CAAC4B,IAAJ;AACA5B,EAAAA,GAAG,CAACsF,wBAAJ,GAA+B,iBAA/B;AACAnF,EAAAA,SAAS,CAACyB,IAAV;AACAzB,EAAAA,SAAS,CAACmF,wBAAV,GAAqC,iBAArC;AACAhG,EAAAA,kBAAkB,CAACU,GAAD,EAAMG,SAAN,EAAiBF,KAAjB,CAAlB;AACAD,EAAAA,GAAG,CAACsC,OAAJ;AACA,SAAOnC,SAAS,CAACmC,OAAV,EAAP;AACD,CARD;;AAUApD,oBAAoB,CAAC,gBAAD,EAAmBC,kBAAnB,EAAuCC,wBAAvC,CAApB;AAEAF,oBAAoB,CAAC,MAAD,EAAS,UAASc,GAAT,EAAcC,KAAd,EAAqB;AAChD,MAAI,CAACA,KAAK,CAACsF,QAAX,EAAqB;AACnBtF,IAAAA,KAAK,CAACuF,aAAN,CAAoBxF,GAApB;AACD;;AACDA,EAAAA,GAAG,CAACe,SAAJ,GAAgBd,KAAK,CAAC2D,KAAtB;AACA,SAAO3D,KAAK,CAACsF,QAAN,CAAeE,IAAf,CAAoBzF,GAApB,EAAyBC,KAAK,CAACW,CAA/B,EAAkCX,KAAK,CAACY,CAAxC,CAAP;AACD,CANmB,CAApB;AAQA3B,oBAAoB,CAAC,SAAD,EAAY,UAASc,GAAT,EAAcC,KAAd,EAAqB;AACnDD,EAAAA,GAAG,CAACe,SAAJ,GAAgBd,KAAK,CAACe,SAAtB;;AACA/B,EAAAA,gBAAgB,CAACe,GAAD,EAAMC,KAAK,CAACqE,MAAZ,EAAoBrE,KAAK,CAACyF,QAA1B,EAAoC,MAApC,CAAhB;;AACA1F,EAAAA,GAAG,CAACuC,IAAJ;AACA,SAAOvC,GAAG,CAACwC,MAAJ,EAAP;AACD,CALmB,CAApB;AAOAmD,MAAM,CAACC,OAAP,GAAiB;AACf1G,EAAAA,oBAAoB,EAAEA,oBADP;AAEfO,EAAAA,mBAAmB,EAAEA,mBAFN;AAGfC,EAAAA,oBAAoB,EAAEA;AAHP,CAAjB","sourcesContent":["var _drawRawLinePath, defineCanvasRenderer, drawErasedLinePath, drawErasedLinePathLatest, drawLinePath, drawLinePathLatest, lineEndCapShapes, noop, renderShapeToCanvas, renderShapeToContext, renderers;\n\nlineEndCapShapes = require('./lineEndCapShapes');\n\nrenderers = {};\n\ndefineCanvasRenderer = function(shapeName, drawFunc, drawLatestFunc) {\n  return renderers[shapeName] = {\n    drawFunc: drawFunc,\n    drawLatestFunc: drawLatestFunc\n  };\n};\n\nnoop = function() {};\n\nrenderShapeToContext = function(ctx, shape, opts) {\n  var bufferCtx;\n  if (opts == null) {\n    opts = {};\n  }\n  if (opts.shouldIgnoreUnsupportedShapes == null) {\n    opts.shouldIgnoreUnsupportedShapes = false;\n  }\n  if (opts.retryCallback == null) {\n    opts.retryCallback = noop;\n  }\n  if (opts.shouldOnlyDrawLatest == null) {\n    opts.shouldOnlyDrawLatest = false;\n  }\n  if (opts.bufferCtx == null) {\n    opts.bufferCtx = null;\n  }\n  bufferCtx = opts.bufferCtx;\n  if (renderers[shape.className]) {\n    if (opts.shouldOnlyDrawLatest && renderers[shape.className].drawLatestFunc) {\n      return renderers[shape.className].drawLatestFunc(ctx, bufferCtx, shape, opts.retryCallback);\n    } else {\n      return renderers[shape.className].drawFunc(ctx, shape, opts.retryCallback);\n    }\n  } else if (opts.shouldIgnoreUnsupportedShapes) {\n    return console.warn(\"Can't render shape of type \" + shape.className + \" to canvas\");\n  } else {\n    throw \"Can't render shape of type \" + shape.className + \" to canvas\";\n  }\n};\n\nrenderShapeToCanvas = function(canvas, shape, opts) {\n  return renderShapeToContext(canvas.getContext('2d'), shape, opts);\n};\n\ndefineCanvasRenderer('Rectangle', function(ctx, shape) {\n  var x, y;\n  x = shape.x;\n  y = shape.y;\n  if (shape.strokeWidth % 2 !== 0) {\n    x += 0.5;\n    y += 0.5;\n  }\n  ctx.fillStyle = shape.fillColor;\n  ctx.fillRect(x, y, shape.width, shape.height);\n  ctx.lineWidth = shape.strokeWidth;\n  ctx.strokeStyle = shape.strokeColor;\n  return ctx.strokeRect(x, y, shape.width, shape.height);\n});\n\ndefineCanvasRenderer('Ellipse', function(ctx, shape) {\n  var centerX, centerY, halfHeight, halfWidth;\n  ctx.save();\n  halfWidth = Math.floor(shape.width / 2);\n  halfHeight = Math.floor(shape.height / 2);\n  centerX = shape.x + halfWidth;\n  centerY = shape.y + halfHeight;\n  ctx.translate(centerX, centerY);\n  ctx.scale(1, Math.abs(shape.height / shape.width));\n  ctx.beginPath();\n  ctx.arc(0, 0, Math.abs(halfWidth), 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.restore();\n  ctx.fillStyle = shape.fillColor;\n  ctx.fill();\n  ctx.lineWidth = shape.strokeWidth;\n  ctx.strokeStyle = shape.strokeColor;\n  return ctx.stroke();\n});\n\ndefineCanvasRenderer('SelectionBox', (function() {\n  var _drawHandle;\n  _drawHandle = function(ctx, arg, handleSize) {\n    var x, y;\n    x = arg.x, y = arg.y;\n    if (handleSize === 0) {\n      return;\n    }\n    ctx.fillStyle = '#fff';\n    ctx.fillRect(x, y, handleSize, handleSize);\n    ctx.strokeStyle = '#000';\n    return ctx.strokeRect(x, y, handleSize, handleSize);\n  };\n  return function(ctx, shape) {\n    _drawHandle(ctx, shape.getTopLeftHandleRect(), shape.handleSize);\n    _drawHandle(ctx, shape.getTopRightHandleRect(), shape.handleSize);\n    _drawHandle(ctx, shape.getBottomLeftHandleRect(), shape.handleSize);\n    _drawHandle(ctx, shape.getBottomRightHandleRect(), shape.handleSize);\n    if (shape.backgroundColor) {\n      ctx.fillStyle = shape.backgroundColor;\n      ctx.fillRect(shape._br.x - shape.margin, shape._br.y - shape.margin, shape._br.width + shape.margin * 2, shape._br.height + shape.margin * 2);\n    }\n    ctx.lineWidth = 1;\n    ctx.strokeStyle = '#000';\n    ctx.setLineDash([2, 4]);\n    ctx.strokeRect(shape._br.x - shape.margin, shape._br.y - shape.margin, shape._br.width + shape.margin * 2, shape._br.height + shape.margin * 2);\n    return ctx.setLineDash([]);\n  };\n})());\n\ndefineCanvasRenderer('Image', function(ctx, shape, retryCallback) {\n  if (shape.image.width) {\n    if (shape.scale === 1) {\n      return ctx.drawImage(shape.image, shape.x, shape.y);\n    } else {\n      return ctx.drawImage(shape.image, shape.x, shape.y, shape.image.width * shape.scale, shape.image.height * shape.scale);\n    }\n  } else if (retryCallback) {\n    return shape.image.onload = retryCallback;\n  }\n});\n\ndefineCanvasRenderer('Line', function(ctx, shape) {\n  var arrowWidth, x1, x2, y1, y2;\n  if (shape.x1 === shape.x2 && shape.y1 === shape.y2) {\n    return;\n  }\n  x1 = shape.x1;\n  x2 = shape.x2;\n  y1 = shape.y1;\n  y2 = shape.y2;\n  if (shape.strokeWidth % 2 !== 0) {\n    x1 += 0.5;\n    x2 += 0.5;\n    y1 += 0.5;\n    y2 += 0.5;\n  }\n  ctx.lineWidth = shape.strokeWidth;\n  ctx.strokeStyle = shape.color;\n  ctx.lineCap = shape.capStyle;\n  if (shape.dash) {\n    ctx.setLineDash(shape.dash);\n  }\n  ctx.beginPath();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.stroke();\n  if (shape.dash) {\n    ctx.setLineDash([]);\n  }\n  arrowWidth = Math.max(shape.strokeWidth * 2.2, 5);\n  if (shape.endCapShapes[0]) {\n    lineEndCapShapes[shape.endCapShapes[0]].drawToCanvas(ctx, x1, y1, Math.atan2(y1 - y2, x1 - x2), arrowWidth, shape.color);\n  }\n  if (shape.endCapShapes[1]) {\n    return lineEndCapShapes[shape.endCapShapes[1]].drawToCanvas(ctx, x2, y2, Math.atan2(y2 - y1, x2 - x1), arrowWidth, shape.color);\n  }\n});\n\n_drawRawLinePath = function(ctx, points, close, lineCap) {\n  var i, len, point, ref;\n  if (close == null) {\n    close = false;\n  }\n  if (lineCap == null) {\n    lineCap = 'round';\n  }\n  if (!points.length) {\n    return;\n  }\n  ctx.lineCap = lineCap;\n  ctx.strokeStyle = points[0].color;\n  ctx.lineWidth = points[0].size;\n  ctx.beginPath();\n  if (points[0].size % 2 === 0) {\n    ctx.moveTo(points[0].x, points[0].y);\n  } else {\n    ctx.moveTo(points[0].x + 0.5, points[0].y + 0.5);\n  }\n  ref = points.slice(1);\n  for (i = 0, len = ref.length; i < len; i++) {\n    point = ref[i];\n    if (points[0].size % 2 === 0) {\n      ctx.lineTo(point.x, point.y);\n    } else {\n      ctx.lineTo(point.x + 0.5, point.y + 0.5);\n    }\n  }\n  if (close) {\n    return ctx.closePath();\n  }\n};\n\ndrawLinePath = function(ctx, shape) {\n  _drawRawLinePath(ctx, shape.smoothedPoints);\n  return ctx.stroke();\n};\n\ndrawLinePathLatest = function(ctx, bufferCtx, shape) {\n  var drawEnd, drawStart, segmentStart;\n  if (shape.tail) {\n    segmentStart = shape.smoothedPoints.length - shape.segmentSize * shape.tailSize;\n    drawStart = segmentStart < shape.segmentSize * 2 ? 0 : segmentStart;\n    drawEnd = segmentStart + shape.segmentSize + 1;\n    _drawRawLinePath(bufferCtx, shape.smoothedPoints.slice(drawStart, drawEnd));\n    return bufferCtx.stroke();\n  } else {\n    _drawRawLinePath(bufferCtx, shape.smoothedPoints);\n    return bufferCtx.stroke();\n  }\n};\n\ndefineCanvasRenderer('LinePath', drawLinePath, drawLinePathLatest);\n\ndrawErasedLinePath = function(ctx, shape) {\n  ctx.save();\n  ctx.globalCompositeOperation = \"destination-out\";\n  drawLinePath(ctx, shape);\n  return ctx.restore();\n};\n\ndrawErasedLinePathLatest = function(ctx, bufferCtx, shape) {\n  ctx.save();\n  ctx.globalCompositeOperation = \"destination-out\";\n  bufferCtx.save();\n  bufferCtx.globalCompositeOperation = \"destination-out\";\n  drawLinePathLatest(ctx, bufferCtx, shape);\n  ctx.restore();\n  return bufferCtx.restore();\n};\n\ndefineCanvasRenderer('ErasedLinePath', drawErasedLinePath, drawErasedLinePathLatest);\n\ndefineCanvasRenderer('Text', function(ctx, shape) {\n  if (!shape.renderer) {\n    shape._makeRenderer(ctx);\n  }\n  ctx.fillStyle = shape.color;\n  return shape.renderer.draw(ctx, shape.x, shape.y);\n});\n\ndefineCanvasRenderer('Polygon', function(ctx, shape) {\n  ctx.fillStyle = shape.fillColor;\n  _drawRawLinePath(ctx, shape.points, shape.isClosed, 'butt');\n  ctx.fill();\n  return ctx.stroke();\n});\n\nmodule.exports = {\n  defineCanvasRenderer: defineCanvasRenderer,\n  renderShapeToCanvas: renderShapeToCanvas,\n  renderShapeToContext: renderShapeToContext\n};\n"]},"metadata":{},"sourceType":"script"}